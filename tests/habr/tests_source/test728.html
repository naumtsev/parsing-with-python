<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>NLog: правила и фильтры / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/450728\/"},"headline":"NLog: правила и фильтры","datePublished":"2019-05-06T17:26:32+03:00","dateModified":"2020-06-17T12:00:23+03:00","author":{"@type":"Person","name":"Иван Якимов"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"NLog: правила и фильтры В Confirmit мы используем библиотеку NLog для логирования в наших .NET-приложениях. Хотя для этой библиотеки существует документация, для...","url":"https:\/\/habr.com\/ru\/post\/450728\/#post-content-body","about":["h_net","f_develop"],"image":["https:\/\/habrastorage.org\/webt\/w7\/d9\/xg\/w7d9xg4zr42cablrpx_euxbnria.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="NLog: правила и фильтры" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="NLog: правила и фильтры" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="NLog: правила и фильтры" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="NLog: правила и фильтры
В Confirmit мы используем библиотеку NLog для логирования в наших .NET-приложениях. Хотя для этой библиотеки существует документация, для меня было сложно понять, как все это..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="NLog: правила и фильтры
В Confirmit мы используем библиотеку NLog для логирования в наших .NET-приложениях. Хотя для этой библиотеки существует документация, для меня было сложно понять, как все это..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="NLog: правила и фильтры
В Confirmit мы используем библиотеку NLog для логирования в наших .NET-приложениях. Хотя для этой библиотеки существует документация, для меня было сложно понять, как все это..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="NLog: правила и фильтры
В Confirmit мы используем библиотеку NLog для логирования в наших .NET-приложениях. Хотя для этой библиотеки существует документация, для меня было сложно понять, как все это..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="NLog: правила и фильтры
В Confirmit мы используем библиотеку NLog для логирования в наших .NET-приложениях. Хотя для этой библиотеки существует документация, для меня было сложно понять, как все это..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/450728/1287c8c71b1e486078ad4112d4db8277/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/450728/1287c8c71b1e486078ad4112d4db8277/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/450728/1287c8c71b1e486078ad4112d4db8277/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/450728/1287c8c71b1e486078ad4112d4db8277/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/450728/1287c8c71b1e486078ad4112d4db8277/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="450728" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2019-05-06T14:26:32.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/450728/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/450728/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/450728/1287c8c71b1e486078ad4112d4db8277/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/iakimov/" title="iakimov" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/e1c/d29/e23/e1cd29e23983088093da10c368451556.jpg" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/iakimov/" class="tm-user-info__username">
      iakimov
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2019-05-06T14:26:32.000Z" title="2019-05-06, 17:26">6  мая  2019 в 17:26</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>NLog: правила и фильтры</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/net/" class="tm-article-snippet__hubs-item-link"><span>.NET</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Перевод
      </span></div></div> <!----> <!----></div></div> <div class="tm-article-presenter__origin"><a href="https://ivanyakimov.blogspot.com/2019/05/nlog-rules-and-filters.html" target="_blank" class="tm-article-presenter__origin-link">
                Автор оригинала:
                <span>
                  Ivan Iakimov
                </span></a></div> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><h1 id="nlog-pravila-i-filtry">NLog: правила и фильтры</h1><br/>
<p>В <a href="https://www.confirmit.com" rel="nofollow">Confirmit</a> мы используем библиотеку <a href="https://github.com/NLog/NLog" rel="nofollow">NLog</a> для логирования в наших .NET-приложениях. Хотя для этой библиотеки существует документация, для меня было сложно понять, как все это работает. В данной статье я попытаюсь объяснить, как правила и фильтры применяются в NLog. Давайте начнем. </p><a name="habracut"></a><br/>
<h2 id="kak-konfigurirovat-nlog">Как конфигурировать NLog</h2><br/>
<p>И начнем мы с небольшого напоминания, что мы можем делать с помощью конфигурации NLog. В простейшем случае, эта конфигурация представляет собой XML-файл (например, NLog.config):</p><br/>
<pre><code class="xml">&lt;?xml version="1.0" encoding="utf-8" ?>
&lt;nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  &lt;targets>
    &lt;target name="target1" xsi:type="ColoredConsole" layout="Access Log|${level:uppercase=true}|${logger}|${message}">
      &lt;highlight-row condition="true" foregroundColor="red"/>
    &lt;/target>
    &lt;target name="target2" xsi:type="ColoredConsole" layout="Common Log|${level:uppercase=true}|${logger}|${message}">
      &lt;highlight-row condition="true" foregroundColor="green"/>
    &lt;/target>
    &lt;target name="target3" xsi:type="ColoredConsole" layout="Yellow Log|${level:uppercase=true}|${logger}|${message}">
      &lt;highlight-row condition="true" foregroundColor="yellow"/>
    &lt;/target>
  &lt;/targets>

  &lt;rules>
    &lt;logger name="*" minlevel="Warn" writeTo="target1,target2,target3" />
  &lt;/rules>
&lt;/nlog></code></pre><br/>
<p>Вы можете загрузить этот файл одной строкой кода:</p><br/>
<pre><code class="cs">LogManager.Configuration = new XmlLoggingConfiguration("NLog.config");</code></pre><br/>
<p>Что мы можем сделать с его помощью? Мы можем установить несколько приемников сообщений (target) на правило:</p><br/>
<pre><code class="xml">&lt;rules>
  &lt;logger name="*" minlevel="Warn" writeTo="target1,target2,target3" />
&lt;/rules></code></pre><br/>
<p>Мы можем определить, для каких уровней логирования это правило задействовано:</p><br/>
<pre><code class="xml">&lt;rules>
  &lt;logger name="*" minlevel="Warn" writeTo="target1" />
  &lt;logger name="*" levels="Debug,Warn,Info" writeTo="target2" />
&lt;/rules></code></pre><br/>
<p>Мы можем задать фильтры для каждого правила:</p><br/>
<pre><code class="xml">&lt;rules>
  &lt;logger name="*" minlevel="Info" writeTo="target1">
    &lt;filters defaultAction='Log'>
      &lt;when condition="contains('${message}','Common')" action="Ignore" />
    &lt;/filters>
  &lt;/logger>
&lt;/rules></code></pre><br/>
<p>И, наконец, мы можем определять вложенные правила:</p><br/>
<pre><code class="xml">&lt;rules>
  &lt;logger name="*" minlevel="Info" writeTo="target1">
    &lt;logger name="*" minlevel="Warn" writeTo="target2" />
  &lt;/logger>
&lt;/rules></code></pre><br/>
<p>Пришло время узнать, как все это работает.</p><br/>
<h2 id="sozdanie-konfiguracii-loggera">Создание конфигурации логгера</h2><br/>
<p>Когда вы запрашиваете экземпляр логгера,</p><br/>
<pre><code class="cs">var commonLogger = LogManager.GetLogger("Common");</code></pre><br/>
<p>NLog или берет уже существующий из кэша, или создает новый(см. <a href="https://github.com/NLog/NLog/blob/af2ca41049fdb29c6da95d8e83156aad9c52d925/src/NLog/LogFactory.cs#L890" rel="nofollow">здесь</a>). В последнем случае для логгера с данным именем так же создается конфигурация. Давайте посмотрим на процесс ее создания.</p><br/>
<p>Кратко говоря, конфигурация логгера представляет собой отдельные цепочки приемников и соответствующих фильтров для каждого уровня логирования (<code>Trace</code>, <code>Debug</code>, <code>Info</code>, <code>Warn</code>, <code>Error</code>, <code>Fatal</code>) (см. <a href="https://github.com/NLog/NLog/blob/af2ca41049fdb29c6da95d8e83156aad9c52d925/src/NLog/Internal/LoggerConfiguration.cs#L41" rel="nofollow">здесь</a>). Сейчас я покажу вам, как эти цепочки строятся.</p><br/>
<p>Главный метод, ответственный за создание данных цепочек — <a href="https://github.com/NLog/NLog/blob/af2ca41049fdb29c6da95d8e83156aad9c52d925/src/NLog/LogFactory.cs#L647" rel="nofollow">GetTargetsByLevelForLogger</a> класса <code>LogFactory</code>. Вот как он работает. Все правила, заданные в конфигурации NLog перебираются по очереди. Прежде всего проверяется, соответствует ли имя правила имени логгера. Имена правил могут содержать подстановочные символы, такие же как те, что мы используем для объектов файловой системы:</p><br/>
<ul>
<li><code>*</code> — произвольная последовательность символов</li>
<li><code>?</code> — любой единичный символ</li>
</ul><br/>
<p>Таким образом имя правила '<code>*</code>' соответствует любому имени логгера, а '<code>Common*</code>' соответствует всем логгерам, чьи имена начинаются с '<code>Common</code>'.</p><br/>
<p>Если имя правила не соответствует имени логгера, то данной правило отбрасывается со всеми вложенными в него правилами. В противном случае метод <code>GetTargetsByLevelForLogger</code> получает все уровни логирования, для которых это правило включено. Для каждого такого уровня NLog добавляет все приемники сообщений, указанные в правиле, в соответствующие цепочки приемников вместе с фильтрами этого правила.</p><br/>
<p>Есть еще одна важная особенность конструирования цепочек приемников. Если текущее правило помечено как <code>final</code> и его имя соответствует имени логгера, то NLog завершает на нем построение цепочек для всех уровней логирования, включенных для данного правила. Это означает, что ни вложенные правила, ни последующие правила ничего не добавят в эти цепочки приемников. Их создание полностью завершено и они уже не будут меняться. Отсюда следует, что не имеет смысла писать что-то подобное:</p><br/>
<pre><code class="xml">&lt;rules>
  &lt;logger name="*" minlevel="Info" writeTo="target1" final="true">
    &lt;logger name="*" minlevel="Warn" writeTo="target2" />
  &lt;/logger>
&lt;/rules></code></pre><br/>
<p>Никакие сообщения не попадут в <code>target2</code>. Но возможно написать что-то такое:</p><br/>
<pre><code class="xml">&lt;rules>
  &lt;logger name="*" minlevel="Warn" writeTo="target1" final="true">
    &lt;logger name="*" minlevel="Info" writeTo="target2" />
  &lt;/logger>
&lt;/rules></code></pre><br/>
<p>Поскольку внешнее правило не включено для уровня <code>Info</code>, цепочка приемников для этого уровня не закончится на внешнем правиле. Поэтому все сообщения с уровнем <code>Info</code> попадут в <code>target2</code>.</p><br/>
<p>После того, как все приемники из данного правила добавлены в соответствующие цепочки, метод рекурсивно обрабатывает все вложенные правила текущего правила по тому же алгоритму. Это происходит вне зависимости от уровней логирования, включенных для родительского правила.</p><br/>
<p>В итого конфигурация для логгера готова. Она содержит цепочки приемников с фильтрами для каждого возможного уровня логирования:</p><br/>
<p><img src="/img/image-loader.svg" alt="Цепочка приемников" data-src="https://habrastorage.org/webt/w7/d9/xg/w7d9xg4zr42cablrpx_euxbnria.png"/></p><br/>
<p>Пришло время посмотреть, как эта конфигурация используется.</p><br/>
<h2 id="ispolzovanie-konfiguracii-loggera">Использование конфигурации логгера</h2><br/>
<p>Начнем с простых вещей. Класс <code>Logger</code> имеет метод <code>IsEnabled</code> и связанные свойства <code>IsXXXEnabled</code> (<code>IsDebugEnabled</code>, <code>IsInfoEnabled</code>, ...). Как они работают? На самом деле они просто проверяют, содержат ли цепочки приемников для заданного уровня логирования хотя бы одно звено (см. <a href="https://github.com/NLog/NLog/blob/af2ca41049fdb29c6da95d8e83156aad9c52d925/src/NLog/Logger.cs#L87" rel="nofollow">здесь</a>). Это означает, что фильтры никогда не влияют на значения этих свойств.</p><br/>
<p>Далее, позвольте мне объяснить, что происходит, когда вы пытаетесь залогировать какое-нибудь сообщение. Как вы могли догадаться, логгер берет цепочку приемников для уровня логирования этого сообщения. Затем он начинает обрабатывать звенья этой цепи одно за другим. Для каждого звена логгер решает, нужно ли записывать сообщение в приемник, указанный в звене, и следует ли после этого продолжать обработку цепочки. Эти решения принимаются с помощью фильтров. Разрешите мне показать, как фильтры работают в NLog.</p><br/>
<p>Вот как фильтры задаются в конфигурации:</p><br/>
<pre><code class="xml">&lt;rules>
  &lt;logger name="*" minlevel="Info" writeTo="target1">
    &lt;filters defaultAction='Log'>
      &lt;when condition="contains('${message}','Common')" action="Ignore" />
    &lt;/filters>
  &lt;/logger>
&lt;/rules></code></pre><br/>
<p>Обычно фильтр содержит некоторое булевское условие. Здесь вы можете решить, что фильтр возвращает <code>true</code> или <code>false</code> для каждого сообщения. Но это не так. Результатом их работы является значение типа <a href="https://github.com/NLog/NLog/blob/2fffff47a50423477a801afb416767cf64e34707/src/NLog/Filters/FilterResult.cs#L39" rel="nofollow"><code>FilterResult</code></a>. Если условие фильтра возвращает <code>true</code>, то результатом работы фильтра становится значение, указанное в атрибуте <code>action</code> (в нашем примере это <code>Ignore</code>). Если же условие возвращает <code>false</code>, то результатом работы фильтра будет <code>Neutral</code>. Это означает, что фильтр не хочет решать, что делать с сообщением.</p><br/>
<p>Вы можете посмотреть, как обрабатывается цепочка приемников <a href="https://github.com/NLog/NLog/blob/af2ca41049fdb29c6da95d8e83156aad9c52d925/src/NLog/LoggerImpl.cs#L98" rel="nofollow">здесь</a>. Для каждого приемника вычисляется результат работы соответствующих фильтров в методе <a href="https://github.com/NLog/NLog/blob/af2ca41049fdb29c6da95d8e83156aad9c52d925/src/NLog/LoggerImpl.cs#L239" rel="nofollow"><code>GetFilterResult</code></a>. Он равен результату работы первого фильтра, вернувшего не <code>Neutral</code>. Это означает, что если некоторый фильтр возвращает значение, отличное от <code>Neutral</code>, все последующие фильтры не выполняются.</p><br/>
<p>Но что произойдет, если все фильтры вернут <code>Neutral</code>? В этом случае будет использоваться значение по умолчанию. Это значение устанавливается с помощью атрибута <code>defaultAction</code> у элемента <code>filters</code> для правила. Как вы думаете, каково значение по умолчанию для <code>defaultAction</code>? Вы правы, если считаете, что это <code>Neutral</code>. То есть вся цепочка фильтров может вернуть <code>Neutral</code> в качестве результата. В этом случае NLog ведет себя так же, как и получив <code>Log</code>. Сообщение будет записано в приемник (см. <a href="https://github.com/NLog/NLog/blob/2fffff47a50423477a801afb416767cf64e34707/src/NLog/LoggerImpl.cs#L201" rel="nofollow">здесь</a>).</p><br/>
<p>Как вы могли догадаться, если фильтр возвращает <code>Ignore</code> или <code>IgnoreFinal</code>, сообщение не будет записано в приемник. Если результат работы фильтра — <code>Log</code> или <code>LogFinal</code>, сообщение будет записано. Но в чем разница между <code>Ignore</code> и <code>IgnoreFinal</code> и между <code>Log</code> или <code>LogFinal</code>? Это просто. В случае <code>IgnoreFinal</code> и <code>LogFinal</code> NLog прекращает обработку цепочки приемников и не пишет ничего в приемники, содержащиеся в последующих звеньях.</p><br/>
<h2 id="zaklyuchenie">Заключение</h2><br/>
<p>Анализ кода NLog помог мне разобраться с тем, как работают правила и фильтры. Надеюсь, что эта статья будет полезна и вам. Удачи!</p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bnlog%5D" class="tm-tags-list__link">nlog</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/net/" class="tm-hubs-list__link">
    .NET
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 15: ↑15 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 15: ↑15 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+15</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">20K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    50
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/iakimov/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/e1c/d29/e23/e1cd29e23983088093da10c368451556.jpg" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 17 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    17
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">3.6</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Иван Якимов</span> <a href="/ru/users/iakimov/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @iakimov
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Программист</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <div class="tm-article-author__user-contacts"><a href="https://www.confirmit.com" rel="noopener" target="_blank" class="tm-article-author__contact">
      Сайт
    </a><a href="https://github.com/yakimovim/" rel="noopener" target="_blank" class="tm-article-author__contact">
      Github
    </a></div></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/450728/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 7 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/450728/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/450728/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"450728":{"id":"450728","timePublished":"2019-05-06T14:26:32+00:00","isCorporative":false,"lang":"ru","titleHtml":"NLog: правила и фильтры","leadData":{"textHtml":"\u003Ch1 id=\"nlog-pravila-i-filtry\"\u003ENLog: правила и фильтры\u003C\u002Fh1\u003E\u003Cbr\u003E\r\n\u003Cp\u003EВ \u003Ca href=\"https:\u002F\u002Fwww.confirmit.com\" rel=\"nofollow\"\u003EConfirmit\u003C\u002Fa\u003E мы используем библиотеку \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNLog\u002FNLog\" rel=\"nofollow\"\u003ENLog\u003C\u002Fa\u003E для логирования в наших .NET-приложениях. Хотя для этой библиотеки существует документация, для меня было сложно понять, как все это работает. В данной статье я попытаюсь объяснить, как правила и фильтры применяются в NLog. Давайте начнем. \u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Ivan Iakimov","originalUrl":"https:\u002F\u002Fivanyakimov.blogspot.com\u002F2019\u002F05\u002Fnlog-rules-and-filters.html"}}],"author":{"scoreStats":{"score":17,"votesCount":17},"rating":3.6,"relatedData":null,"contacts":[{"title":"Сайт","url":"https:\u002F\u002Fwww.confirmit.com","value":"https:\u002F\u002Fwww.confirmit.com"},{"title":"Github","url":"https:\u002F\u002Fgithub.com\u002Fyakimovim\u002F","value":"yakimovim"}],"authorContacts":[{"title":"Сайт","url":"https:\u002F\u002Fwww.confirmit.com","value":"https:\u002F\u002Fwww.confirmit.com"},{"title":"Github","url":"https:\u002F\u002Fgithub.com\u002Fyakimovim\u002F","value":"yakimovim"}],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"1547171","alias":"iakimov","fullname":"Иван Якимов","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fe1c\u002Fd29\u002Fe23\u002Fe1cd29e23983088093da10c368451556.jpg","speciality":"Программист"},"statistics":{"commentsCount":7,"favoritesCount":50,"readingCount":19869,"score":15,"votesCount":15},"hubs":[{"relatedData":null,"id":"546","alias":"net","type":"collective","title":".NET","titleHtml":".NET","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Ch1 id=\"nlog-pravila-i-filtry\"\u003ENLog: правила и фильтры\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ \u003Ca href=\"https:\u002F\u002Fwww.confirmit.com\" rel=\"nofollow\"\u003EConfirmit\u003C\u002Fa\u003E мы используем библиотеку \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNLog\u002FNLog\" rel=\"nofollow\"\u003ENLog\u003C\u002Fa\u003E для логирования в наших .NET-приложениях. Хотя для этой библиотеки существует документация, для меня было сложно понять, как все это работает. В данной статье я попытаюсь объяснить, как правила и фильтры применяются в NLog. Давайте начнем. \u003C\u002Fp\u003E\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"kak-konfigurirovat-nlog\"\u003EКак конфигурировать NLog\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ начнем мы с небольшого напоминания, что мы можем делать с помощью конфигурации NLog. В простейшем случае, эта конфигурация представляет собой XML-файл (например, NLog.config):\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;?xml version=\"1.0\" encoding=\"utf-8\" ?\u003E\n&lt;nlog xmlns=\"http:\u002F\u002Fwww.nlog-project.org\u002Fschemas\u002FNLog.xsd\"\n      xmlns:xsi=\"http:\u002F\u002Fwww.w3.org\u002F2001\u002FXMLSchema-instance\"\u003E\n\n  &lt;targets\u003E\n    &lt;target name=\"target1\" xsi:type=\"ColoredConsole\" layout=\"Access Log|${level:uppercase=true}|${logger}|${message}\"\u003E\n      &lt;highlight-row condition=\"true\" foregroundColor=\"red\"\u002F\u003E\n    &lt;\u002Ftarget\u003E\n    &lt;target name=\"target2\" xsi:type=\"ColoredConsole\" layout=\"Common Log|${level:uppercase=true}|${logger}|${message}\"\u003E\n      &lt;highlight-row condition=\"true\" foregroundColor=\"green\"\u002F\u003E\n    &lt;\u002Ftarget\u003E\n    &lt;target name=\"target3\" xsi:type=\"ColoredConsole\" layout=\"Yellow Log|${level:uppercase=true}|${logger}|${message}\"\u003E\n      &lt;highlight-row condition=\"true\" foregroundColor=\"yellow\"\u002F\u003E\n    &lt;\u002Ftarget\u003E\n  &lt;\u002Ftargets\u003E\n\n  &lt;rules\u003E\n    &lt;logger name=\"*\" minlevel=\"Warn\" writeTo=\"target1,target2,target3\" \u002F\u003E\n  &lt;\u002Frules\u003E\n&lt;\u002Fnlog\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВы можете загрузить этот файл одной строкой кода:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"cs\"\u003ELogManager.Configuration = new XmlLoggingConfiguration(\"NLog.config\");\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЧто мы можем сделать с его помощью? Мы можем установить несколько приемников сообщений (target) на правило:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;rules\u003E\n  &lt;logger name=\"*\" minlevel=\"Warn\" writeTo=\"target1,target2,target3\" \u002F\u003E\n&lt;\u002Frules\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМы можем определить, для каких уровней логирования это правило задействовано:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;rules\u003E\n  &lt;logger name=\"*\" minlevel=\"Warn\" writeTo=\"target1\" \u002F\u003E\n  &lt;logger name=\"*\" levels=\"Debug,Warn,Info\" writeTo=\"target2\" \u002F\u003E\n&lt;\u002Frules\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМы можем задать фильтры для каждого правила:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;rules\u003E\n  &lt;logger name=\"*\" minlevel=\"Info\" writeTo=\"target1\"\u003E\n    &lt;filters defaultAction='Log'\u003E\n      &lt;when condition=\"contains('${message}','Common')\" action=\"Ignore\" \u002F\u003E\n    &lt;\u002Ffilters\u003E\n  &lt;\u002Flogger\u003E\n&lt;\u002Frules\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EИ, наконец, мы можем определять вложенные правила:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;rules\u003E\n  &lt;logger name=\"*\" minlevel=\"Info\" writeTo=\"target1\"\u003E\n    &lt;logger name=\"*\" minlevel=\"Warn\" writeTo=\"target2\" \u002F\u003E\n  &lt;\u002Flogger\u003E\n&lt;\u002Frules\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПришло время узнать, как все это работает.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"sozdanie-konfiguracii-loggera\"\u003EСоздание конфигурации логгера\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКогда вы запрашиваете экземпляр логгера,\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"cs\"\u003Evar commonLogger = LogManager.GetLogger(\"Common\");\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003ENLog или берет уже существующий из кэша, или создает новый(см. \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNLog\u002FNLog\u002Fblob\u002Faf2ca41049fdb29c6da95d8e83156aad9c52d925\u002Fsrc\u002FNLog\u002FLogFactory.cs#L890\" rel=\"nofollow\"\u003Eздесь\u003C\u002Fa\u003E). В последнем случае для логгера с данным именем так же создается конфигурация. Давайте посмотрим на процесс ее создания.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКратко говоря, конфигурация логгера представляет собой отдельные цепочки приемников и соответствующих фильтров для каждого уровня логирования (\u003Ccode\u003ETrace\u003C\u002Fcode\u003E, \u003Ccode\u003EDebug\u003C\u002Fcode\u003E, \u003Ccode\u003EInfo\u003C\u002Fcode\u003E, \u003Ccode\u003EWarn\u003C\u002Fcode\u003E, \u003Ccode\u003EError\u003C\u002Fcode\u003E, \u003Ccode\u003EFatal\u003C\u002Fcode\u003E) (см. \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNLog\u002FNLog\u002Fblob\u002Faf2ca41049fdb29c6da95d8e83156aad9c52d925\u002Fsrc\u002FNLog\u002FInternal\u002FLoggerConfiguration.cs#L41\" rel=\"nofollow\"\u003Eздесь\u003C\u002Fa\u003E). Сейчас я покажу вам, как эти цепочки строятся.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EГлавный метод, ответственный за создание данных цепочек — \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNLog\u002FNLog\u002Fblob\u002Faf2ca41049fdb29c6da95d8e83156aad9c52d925\u002Fsrc\u002FNLog\u002FLogFactory.cs#L647\" rel=\"nofollow\"\u003EGetTargetsByLevelForLogger\u003C\u002Fa\u003E класса \u003Ccode\u003ELogFactory\u003C\u002Fcode\u003E. Вот как он работает. Все правила, заданные в конфигурации NLog перебираются по очереди. Прежде всего проверяется, соответствует ли имя правила имени логгера. Имена правил могут содержать подстановочные символы, такие же как те, что мы используем для объектов файловой системы:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ccode\u003E*\u003C\u002Fcode\u003E — произвольная последовательность символов\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ccode\u003E?\u003C\u002Fcode\u003E — любой единичный символ\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EТаким образом имя правила '\u003Ccode\u003E*\u003C\u002Fcode\u003E' соответствует любому имени логгера, а '\u003Ccode\u003ECommon*\u003C\u002Fcode\u003E' соответствует всем логгерам, чьи имена начинаются с '\u003Ccode\u003ECommon\u003C\u002Fcode\u003E'.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсли имя правила не соответствует имени логгера, то данной правило отбрасывается со всеми вложенными в него правилами. В противном случае метод \u003Ccode\u003EGetTargetsByLevelForLogger\u003C\u002Fcode\u003E получает все уровни логирования, для которых это правило включено. Для каждого такого уровня NLog добавляет все приемники сообщений, указанные в правиле, в соответствующие цепочки приемников вместе с фильтрами этого правила.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЕсть еще одна важная особенность конструирования цепочек приемников. Если текущее правило помечено как \u003Ccode\u003Efinal\u003C\u002Fcode\u003E и его имя соответствует имени логгера, то NLog завершает на нем построение цепочек для всех уровней логирования, включенных для данного правила. Это означает, что ни вложенные правила, ни последующие правила ничего не добавят в эти цепочки приемников. Их создание полностью завершено и они уже не будут меняться. Отсюда следует, что не имеет смысла писать что-то подобное:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;rules\u003E\n  &lt;logger name=\"*\" minlevel=\"Info\" writeTo=\"target1\" final=\"true\"\u003E\n    &lt;logger name=\"*\" minlevel=\"Warn\" writeTo=\"target2\" \u002F\u003E\n  &lt;\u002Flogger\u003E\n&lt;\u002Frules\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНикакие сообщения не попадут в \u003Ccode\u003Etarget2\u003C\u002Fcode\u003E. Но возможно написать что-то такое:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;rules\u003E\n  &lt;logger name=\"*\" minlevel=\"Warn\" writeTo=\"target1\" final=\"true\"\u003E\n    &lt;logger name=\"*\" minlevel=\"Info\" writeTo=\"target2\" \u002F\u003E\n  &lt;\u002Flogger\u003E\n&lt;\u002Frules\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПоскольку внешнее правило не включено для уровня \u003Ccode\u003EInfo\u003C\u002Fcode\u003E, цепочка приемников для этого уровня не закончится на внешнем правиле. Поэтому все сообщения с уровнем \u003Ccode\u003EInfo\u003C\u002Fcode\u003E попадут в \u003Ccode\u003Etarget2\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПосле того, как все приемники из данного правила добавлены в соответствующие цепочки, метод рекурсивно обрабатывает все вложенные правила текущего правила по тому же алгоритму. Это происходит вне зависимости от уровней логирования, включенных для родительского правила.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ итого конфигурация для логгера готова. Она содержит цепочки приемников с фильтрами для каждого возможного уровня логирования:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Цепочка приемников\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fw7\u002Fd9\u002Fxg\u002Fw7d9xg4zr42cablrpx_euxbnria.png\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПришло время посмотреть, как эта конфигурация используется.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"ispolzovanie-konfiguracii-loggera\"\u003EИспользование конфигурации логгера\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНачнем с простых вещей. Класс \u003Ccode\u003ELogger\u003C\u002Fcode\u003E имеет метод \u003Ccode\u003EIsEnabled\u003C\u002Fcode\u003E и связанные свойства \u003Ccode\u003EIsXXXEnabled\u003C\u002Fcode\u003E (\u003Ccode\u003EIsDebugEnabled\u003C\u002Fcode\u003E, \u003Ccode\u003EIsInfoEnabled\u003C\u002Fcode\u003E, ...). Как они работают? На самом деле они просто проверяют, содержат ли цепочки приемников для заданного уровня логирования хотя бы одно звено (см. \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNLog\u002FNLog\u002Fblob\u002Faf2ca41049fdb29c6da95d8e83156aad9c52d925\u002Fsrc\u002FNLog\u002FLogger.cs#L87\" rel=\"nofollow\"\u003Eздесь\u003C\u002Fa\u003E). Это означает, что фильтры никогда не влияют на значения этих свойств.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДалее, позвольте мне объяснить, что происходит, когда вы пытаетесь залогировать какое-нибудь сообщение. Как вы могли догадаться, логгер берет цепочку приемников для уровня логирования этого сообщения. Затем он начинает обрабатывать звенья этой цепи одно за другим. Для каждого звена логгер решает, нужно ли записывать сообщение в приемник, указанный в звене, и следует ли после этого продолжать обработку цепочки. Эти решения принимаются с помощью фильтров. Разрешите мне показать, как фильтры работают в NLog.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВот как фильтры задаются в конфигурации:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"xml\"\u003E&lt;rules\u003E\n  &lt;logger name=\"*\" minlevel=\"Info\" writeTo=\"target1\"\u003E\n    &lt;filters defaultAction='Log'\u003E\n      &lt;when condition=\"contains('${message}','Common')\" action=\"Ignore\" \u002F\u003E\n    &lt;\u002Ffilters\u003E\n  &lt;\u002Flogger\u003E\n&lt;\u002Frules\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОбычно фильтр содержит некоторое булевское условие. Здесь вы можете решить, что фильтр возвращает \u003Ccode\u003Etrue\u003C\u002Fcode\u003E или \u003Ccode\u003Efalse\u003C\u002Fcode\u003E для каждого сообщения. Но это не так. Результатом их работы является значение типа \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNLog\u002FNLog\u002Fblob\u002F2fffff47a50423477a801afb416767cf64e34707\u002Fsrc\u002FNLog\u002FFilters\u002FFilterResult.cs#L39\" rel=\"nofollow\"\u003E\u003Ccode\u003EFilterResult\u003C\u002Fcode\u003E\u003C\u002Fa\u003E. Если условие фильтра возвращает \u003Ccode\u003Etrue\u003C\u002Fcode\u003E, то результатом работы фильтра становится значение, указанное в атрибуте \u003Ccode\u003Eaction\u003C\u002Fcode\u003E (в нашем примере это \u003Ccode\u003EIgnore\u003C\u002Fcode\u003E). Если же условие возвращает \u003Ccode\u003Efalse\u003C\u002Fcode\u003E, то результатом работы фильтра будет \u003Ccode\u003ENeutral\u003C\u002Fcode\u003E. Это означает, что фильтр не хочет решать, что делать с сообщением.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВы можете посмотреть, как обрабатывается цепочка приемников \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNLog\u002FNLog\u002Fblob\u002Faf2ca41049fdb29c6da95d8e83156aad9c52d925\u002Fsrc\u002FNLog\u002FLoggerImpl.cs#L98\" rel=\"nofollow\"\u003Eздесь\u003C\u002Fa\u003E. Для каждого приемника вычисляется результат работы соответствующих фильтров в методе \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNLog\u002FNLog\u002Fblob\u002Faf2ca41049fdb29c6da95d8e83156aad9c52d925\u002Fsrc\u002FNLog\u002FLoggerImpl.cs#L239\" rel=\"nofollow\"\u003E\u003Ccode\u003EGetFilterResult\u003C\u002Fcode\u003E\u003C\u002Fa\u003E. Он равен результату работы первого фильтра, вернувшего не \u003Ccode\u003ENeutral\u003C\u002Fcode\u003E. Это означает, что если некоторый фильтр возвращает значение, отличное от \u003Ccode\u003ENeutral\u003C\u002Fcode\u003E, все последующие фильтры не выполняются.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНо что произойдет, если все фильтры вернут \u003Ccode\u003ENeutral\u003C\u002Fcode\u003E? В этом случае будет использоваться значение по умолчанию. Это значение устанавливается с помощью атрибута \u003Ccode\u003EdefaultAction\u003C\u002Fcode\u003E у элемента \u003Ccode\u003Efilters\u003C\u002Fcode\u003E для правила. Как вы думаете, каково значение по умолчанию для \u003Ccode\u003EdefaultAction\u003C\u002Fcode\u003E? Вы правы, если считаете, что это \u003Ccode\u003ENeutral\u003C\u002Fcode\u003E. То есть вся цепочка фильтров может вернуть \u003Ccode\u003ENeutral\u003C\u002Fcode\u003E в качестве результата. В этом случае NLog ведет себя так же, как и получив \u003Ccode\u003ELog\u003C\u002Fcode\u003E. Сообщение будет записано в приемник (см. \u003Ca href=\"https:\u002F\u002Fgithub.com\u002FNLog\u002FNLog\u002Fblob\u002F2fffff47a50423477a801afb416767cf64e34707\u002Fsrc\u002FNLog\u002FLoggerImpl.cs#L201\" rel=\"nofollow\"\u003Eздесь\u003C\u002Fa\u003E).\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКак вы могли догадаться, если фильтр возвращает \u003Ccode\u003EIgnore\u003C\u002Fcode\u003E или \u003Ccode\u003EIgnoreFinal\u003C\u002Fcode\u003E, сообщение не будет записано в приемник. Если результат работы фильтра — \u003Ccode\u003ELog\u003C\u002Fcode\u003E или \u003Ccode\u003ELogFinal\u003C\u002Fcode\u003E, сообщение будет записано. Но в чем разница между \u003Ccode\u003EIgnore\u003C\u002Fcode\u003E и \u003Ccode\u003EIgnoreFinal\u003C\u002Fcode\u003E и между \u003Ccode\u003ELog\u003C\u002Fcode\u003E или \u003Ccode\u003ELogFinal\u003C\u002Fcode\u003E? Это просто. В случае \u003Ccode\u003EIgnoreFinal\u003C\u002Fcode\u003E и \u003Ccode\u003ELogFinal\u003C\u002Fcode\u003E NLog прекращает обработку цепочки приемников и не пишет ничего в приемники, содержащиеся в последующих звеньях.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"zaklyuchenie\"\u003EЗаключение\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EАнализ кода NLog помог мне разобраться с тем, как работают правила и фильтры. Надеюсь, что эта статья будет полезна и вам. Удачи!\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"nlog"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F450728\u002F1287c8c71b1e486078ad4112d4db8277\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F450728\u002F1287c8c71b1e486078ad4112d4db8277\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F450728\\\u002F\"},\"headline\":\"NLog: правила и фильтры\",\"datePublished\":\"2019-05-06T17:26:32+03:00\",\"dateModified\":\"2020-06-17T12:00:23+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Иван Якимов\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"NLog: правила и фильтры В Confirmit мы используем библиотеку NLog для логирования в наших .NET-приложениях. Хотя для этой библиотеки существует документация, для...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F450728\\\u002F#post-content-body\",\"about\":[\"h_net\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fw7\\\u002Fd9\\\u002Fxg\\\u002Fw7d9xg4zr42cablrpx_euxbnria.png\"]}","metaDescription":"NLog: правила и фильтры\r\nВ Confirmit мы используем библиотеку NLog для логирования в наших .NET-приложениях. Хотя для этой библиотеки существует документация, для меня было сложно понять, как все это...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"net"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
