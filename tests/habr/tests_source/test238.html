<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Валидация по TypeScript interface с использованием Joi / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/450238\/"},"headline":"Валидация по TypeScript interface с использованием Joi","datePublished":"2019-05-01T06:59:11+03:00","dateModified":"2019-05-07T10:55:36+03:00","author":{"@type":"Person","name":"Сергей Мелодин"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"История о том, как потратить два дня на многократное переписывание одного и того же кода.  Вступление В рамках данной статьи опущу подробности про Hapi, Joi, роу...","url":"https:\/\/habr.com\/ru\/post\/450238\/#post-content-body","about":["h_javascript","h_typescript","f_develop"],"image":["https:\/\/habrastorage.org\/webt\/kv\/do\/eq\/kvdoeq2qi2shhsd1gtl76hjorvs.png","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/c86\/32b\/ef0\/c8632bef03e0bc08cb00b9040e05dd8c.jpg","https:\/\/habrastorage.org\/getpro\/habr\/post_images\/f8c\/4c4\/96b\/f8c4c496b545e0d6bd4a249feda9095f.jpg","https:\/\/i01.fotocdn.net\/s27\/157\/public_pin_m\/250\/2670655900.jpg"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Валидация по TypeScript interface с использованием Joi" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Валидация по TypeScript interface с использованием Joi" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Валидация по TypeScript interface с использованием Joi" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="История о том, как потратить два дня на многократное переписывание одного и того же кода.

Вступление
В рамках данной статьи опущу подробности про Hapi, Joi, роутинг и validate: { payload: ... },..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="История о том, как потратить два дня на многократное переписывание одного и того же кода.

Вступление
В рамках данной статьи опущу подробности про Hapi, Joi, роутинг и validate: { payload: ... },..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="История о том, как потратить два дня на многократное переписывание одного и того же кода.

Вступление
В рамках данной статьи опущу подробности про Hapi, Joi, роутинг и validate: { payload: ... },..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="История о том, как потратить два дня на многократное переписывание одного и того же кода.

Вступление
В рамках данной статьи опущу подробности про Hapi, Joi, роутинг и validate: { payload: ... },..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="История о том, как потратить два дня на многократное переписывание одного и того же кода.

Вступление
В рамках данной статьи опущу подробности про Hapi, Joi, роутинг и validate: { payload: ... },..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/450238/841450cfe73cbc0adc19a639aade25c1/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/450238/841450cfe73cbc0adc19a639aade25c1/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/450238/841450cfe73cbc0adc19a639aade25c1/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/450238/841450cfe73cbc0adc19a639aade25c1/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/450238/841450cfe73cbc0adc19a639aade25c1/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="450238" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2019-05-01T03:59:11.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/450238/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/450238/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/450238/841450cfe73cbc0adc19a639aade25c1/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/melodyn/" title="melodyn" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/7ae/567/2ef/7ae5672ef960b29a3972ce112f9a7ede.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/melodyn/" class="tm-user-info__username">
      melodyn
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2019-05-01T03:59:11.000Z" title="2019-05-01, 06:59">1  мая  2019 в 06:59</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Валидация по TypeScript interface с использованием Joi</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/javascript/" class="tm-article-snippet__hubs-item-link"><span>JavaScript</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/typescript/" class="tm-article-snippet__hubs-item-link"><span>TypeScript</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <!----> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><p>История о том, как потратить два дня на многократное переписывание одного и того же кода.</p><br/>
<p><img src="/img/image-loader.svg" alt="Joi &amp; TypeScript. A love story" title="Joi &amp; TypeScript. A love story" data-src="https://habrastorage.org/webt/kv/do/eq/kvdoeq2qi2shhsd1gtl76hjorvs.png"/></p><a name="habracut"></a><br/>
<h1 id="vstuplenie">Вступление</h1><br/>
<p>В рамках данной статьи опущу подробности про Hapi, Joi, роутинг и <code>validate: { payload: ... }</code>, подразумевая, что вы уже понимаете о чём речь, как и терминологию, а-ля "интерфейсы", "типы" и тому подобное. Расскажу лишь о пошаговой, не самой удачной стратегии, своего обучения этим вещам.</p><br/>
<h2 id="nemnogo-predystorii">Немного предыстории</h2><br/>
<p>Сейчас я единственный backend разработчик (именно, пишущий код) на проекте. Функциональность — не суть, но ключевая сущность — это довольно длинная анкета с личными данными. Скорость работы и качество кода завязано на моём малом опыте самостоятельной работы над проектами с нуля, ещё более малом опыте работы с JS (всего 4й месяц) и попутно, очень криво-косо, пишу на TypeScript (далее — TS). Сроки сжаты, булки сжаты, постоянно прилетают правки и получается сначала писать код бизнес-логики, а потом сверху интерфейсы. Тем не менее, технический долг способен догнать и настучать по шапке, что, примерно, с нами и случилось.</p><br/>
<p>После 3х месяцев работы над проектом, договорился наконец с коллегами о переходе на единый словарь, чтобы везде свойства объекта назывались и писались одинаково. Под это дело, разумеется, взялся писать интерфейс и плотно застрял с ним на два рабочих дня.</p><br/>
<h1 id="problema">Проблема</h1><br/>
<p>В качестве абстрактного примера выступит простая анкета пользователя.</p><br/>
<ul>
<li><strong><del>Первый</del> Нулевой шаг хорошего разработчика:</strong> <del>описать данные</del> написать тесты;</li>
<li><strong>Первый шаг:</strong> <del>написать тесты</del> описать данные;</li>
<li>ну и так далее.</li>
</ul><br/>
<p>Допустим, на этот код уже написаны тесты, осталось описать данные:</p><br/>
<pre><code class="javascript">interface IUser {
  name: string; 
  age: number;
  phone: string | number;
}

const aleg: IUser = {
  name: 'Aleg',
  age: 45,
  phone: '79001231212'
};</code></pre><br/>
<p>Чтож, тут всё понятно и предельно просто. Весь этот код, как мы помним, на бэкэнде, а точнее, в api, то есть пользователь создаётся на основе данных, которые пришли по сети. Таким образом, нам нужно сделать валидацию входящих данных и поможет в этом Joi:</p><br/>
<pre><code class="javascript">const joiUserValidator = {
  name: Joi.string(),
  age: Joi.number(),
  phone: Joi.alternatives([Joi.string(), Joi.number()])
};</code></pre><br/>
<p>Решение "в лоб" готово. Очевидный минус такого подхода — валидатор полностью оторван от интерфейса. Если в процессе жизни приложения изменятся / добавятся поля или поменяется их тип, то данное изменение надо будет вручную отследить и указать в валидаторе. Думаю, таких ответственных разработчиков не будет до тех пор, пока что-то не упадёт. Кроме того, в нашем проекте, анкета состоит из 50+ полей на трёх уровнях вложенности и разбираться в этом крайне сложно, даже зная всё наизусть.</p><br/>
<p>Просто указать <code>const joiUserValidator: IUser</code> мы не можем, потому что <code>Joi</code> использует свои типы данных, что порождает при компиляции ошибки вида <code>Type 'NumberSchema' is not assignable to type 'number'</code>. Но ведь должен быть способ выполнить валидацию по интерфейсу?<br/>
<img src="https://habrastorage.org/r/w780q1/getpro/habr/post_images/c86/32b/ef0/c8632bef03e0bc08cb00b9040e05dd8c.jpg" alt="Я вышел в интернет с таким вопросом" title="Я вышел в интернет с таким вопросом" data-src="https://habrastorage.org/getpro/habr/post_images/c86/32b/ef0/c8632bef03e0bc08cb00b9040e05dd8c.jpg" data-blurred="true"/></p><br/>
<p>Возможно, я неправильно гуглил, или плохо изучал ответы, но все решения сводились к либе <code>extractTypes</code> и каким-то лютым велосипедам, типа <a href="https://github.com/hapijs/joi/issues/1557">такого</a>:</p><br/>
<pre><code class="javascript">type ValidatedValueType&lt;T extends joi.Schema> = T extends joi.StringSchema
  ? string
  : T extends joi.NumberSchema
    ? number
    : T extends joi.BooleanSchema
      ? boolean
      : T extends joi.ObjectSchema ? ValidatedObjectType&lt;T> : 
      /* ... more schemata ... */ never;</code></pre><br/>
<h1 id="reshenie">Решение</h1><br/>
<h2 id="ispolzovat-storonnie-biblioteki">Использовать сторонние библиотеки</h2><br/>
<p>Почему бы нет. Когда я вопрошал к людям со своей задачей, то получил в одном из ответов, а позже, и тут, в комментариях (спасибо <a href="https://habr.com/ru/users/keenondrums/" class="user_link">keenondrums</a> ), ссылки на данные библиотеки:<br/>
<a href="https://github.com/typestack/class-validator">https://github.com/typestack/class-validator</a><br/>
<a href="https://github.com/typestack/class-transformer">https://github.com/typestack/class-transformer</a></p><br/>
<p>Однако, был интерес разобраться самому, понять лучше работу TS, да и ничего не поджимало решить задачу сиюминутно.</p><br/>
<h2 id="poluchit-vse-svoystva">Получить все свойства</h2><br/>
<p>Поскольку со статикой ранее дел я не имел, вышеуказанный код открыл Америку в плане применения тернарных операторов в типах. К счастью, применить его в проекте не удалось. Зато нашёл другой интересный велосипед:</p><br/>
<pre><code class="javascript">interface IUser {
  name: string; 
  age: number;
  phone: string | number;
}

type UserKeys&lt;T> = {
  [key in keyof T];
}

const evan: UserKeys&lt;IUser> = {
  name: 'Evan',
  age: 32,
  phone: 791234567890
};

const joiUser: UserKeys&lt;IUser> = {
  name: Joi.string(),
  age: Joi.number(),
  phone: Joi.alternatives([Joi.string(), Joi.number()])
};</code></pre><br/>
<p><code>TypeScript</code> при довольно хитрых и загадочных условиях позволяет получить, например, ключи из интерфейса, словно это нормальный JS-объект, правда, только в конструкции <code>type</code> и через <code>key in keyof T</code> и только через дженерики. В результате работы типа <code>UserKeys</code>, у всех объектов, реализующих интерфейсы, должен быть одинаковый набор свойств, но при этом типы значений могут быть произвольные. Это включает подсказки в IDE, но всё ещё не даёт однозначно обозначить типы значений.</p><br/>
<p>Здесь есть ещё один интересный кейс, который не смог использовать. Возможно, вы подскажете зачем это нужно (хотя я частично догадываюсь, не хватает прикладного примера):</p><br/>
<pre><code class="javascript">interface IUser {
  name: string; 
  age: number;
  phone: string | number;
}

interface IUserJoi {
  name: Joi.StringSchema,
  age: Joi.NumberSchema,
  phone: Joi.AlternativesSchema
}

type UserKeys&lt;T> = {
  [key in keyof T]: T[key];
}

const evan: UserKeys&lt;IUser> = {
  name: 'Evan',
  age: 32,
  phone: 791234567890
};

const userJoiValidator: UserKeys&lt;IUserJoi> = {
  name: Joi.string(),
  age: Joi.number(),
  phone: Joi.alternatives([Joi.string(), Joi.number()])
};</code></pre><br/>
<h2 id="ispolzovat-variativnye-tipy">Использовать вариативные типы</h2><br/>
<p>Можно явно задать типы, а используя "ИЛИ" и извлечение свойств, получить локально работоспособный код:</p><br/>
<pre><code class="javascript">type TString = string | Joi.StringSchema;
type TNumber = number | Joi.NumberSchema;
type TStdAlter = TString | TNumber;
type TAlter = TStdAlter | Joi.AlternativesSchema;

export interface IUser {
  name: TString;
  age: TNumber;
  phone: TAlter;
}

type UserKeys&lt;T> = {
  [key in keyof T];
}

const olex: UserKeys&lt;IUser> = {
  name: 'Olex',
  age: 67,
  phone: '79998887766'
};

const joiUser: UserKeys&lt;IUser> = {
  name: Joi.string(),
  age: Joi.number(),
  phone: Joi.alternatives([Joi.string(), Joi.number()])
};</code></pre><br/>
<p>Проблема этого кода проявляется когда мы хотим забрать валидный объект, например, из базы, то есть TS заранее не знает какого типа данные будут — простые или Joi. Это может вызвать ошибку при попытке выполнить математические операции с полем, которое ожидается как <code>number</code>:</p><br/>
<pre><code class="javascript">const someUser: IUser = getUserFromDB({ name: 'Aleg' });
const someWeirdMath = someUser.age % 10; // error TS2362: The left-hand side of an arithmetic operation must be of type'any', 'number', 'bigint' or an enum type</code></pre><br/>
<p>Данная ошибка приходит из <code>Joi.NumberSchema</code> потому что возраст может быть не только <code>number</code>. За что боролись на то и напоролись.</p><br/>
<h2 id="soedinit-dva-resheniya-v-odno">Соединить два решения в одно?</h2><br/>
<p>Где-то к этому моменту рабочий день подходил к логическому завершению. Я перевёл дух, выпил кофе и стёр эту порнографию к чертям. Надо меньше читать эти ваши интернеты! Настало время <del>взять дробовик и</del> пораскинуть мозгами:</p><br/>
<ol>
<li>Объект должен формироваться с явными типами значений;</li>
<li>Можно использовать дженерики, чтобы прокидывать типы в один интерфейс;</li>
<li>Дженерики поддерживают типы по умолчанию;</li>
<li>Конструкция <code>type</code> явно способна на что-то ещё.</li>
</ol><br/>
<p>Пишем интерфейс-дженерик с типами по умолчанию:</p><br/>
<pre><code class="javascript">interface IUser
&lt;
  TName = string,
  TAge = number,
  TAlt = string | number
> {
  name: TName; 
  age: TAge;
  phone: TAlt;
}</code></pre><br/>
<p>Для Joi можно было бы создать второй интерфейс, наследовав основной таким образом:</p><br/>
<pre><code class="javascript">interface IUserJoi extends IUser
&lt;
  Joi.StringSchema,
  Joi.NumberSchema,
  Joi.AlternativesSchema
> {}</code></pre><br/>
<p>Недостаточно хорошо, ведь следующий разработчик может с лёгким сердцем расширить <code>IUserJoi</code> или что похуже. Более ограниченный вариант получить похожее поведение:</p><br/>
<pre><code class="javascript">type IUserJoi = IUser&lt;Joi.StringSchema, Joi.NumberSchema, Joi.AlternativesSchema>;</code></pre><br/>
<p>Пробуем:</p><br/>
<pre><code class="javascript">const aleg: IUser = {
  name: 'Aleg',
  age: 45,
  phone: '79001231212'
};

const joiUser: IUserJoi = {
  name: Joi.string(),
  age: Joi.number(),
  phone: Joi.alternatives([Joi.string(), Joi.number()])
};</code></pre><br/>
<p><strong>UPD:</strong><br/>
Для оборачивания в <code>Joi.object</code> пришлось побороться с ошибкой <code>TS2345</code> и самым простым решение оказался <code>as any</code>. Думаю, это не критичное допущение, ведь выше объект всё равно по интерфейсу.</p><br/>
<pre><code class="javascript">const joiUserInfo = {
  info: Joi.object(joiUser as any).required()
};</code></pre><br/>
<p>Компилится, на месте использования выглядит аккуратно и при отсутствии особых условий всегда устанавливает типы по умолчанию! Красота…<br/>
<img src="https://habrastorage.org/r/w780q1/getpro/habr/post_images/f8c/4c4/96b/f8c4c496b545e0d6bd4a249feda9095f.jpg" alt="печаль-беда" title="печаль-беда" data-src="https://habrastorage.org/getpro/habr/post_images/f8c/4c4/96b/f8c4c496b545e0d6bd4a249feda9095f.jpg" data-blurred="true"/><br/>
… на что я потратил два рабочих дня</p><br/>
<h1 id="rezyumirovanie">Резюмирование</h1><br/>
<p><strong>Какие выводы из всего этого можно сделать:</strong></p><br/>
<ol>
<li>Очевидно, я не научился находить ответы на вопросы. Наверняка при удачном запросе это решение (а то и ещё лучше) находится в первой 5ке ссылок поисковика;</li>
<li>Переключиться на статическое мышление с динамического не так просто, гораздо чаще я просто забиваю на такое копошение;</li>
<li>Дженерики — крутая штука. На хабре и стековерфлоу полно <del>велосипедов</del> неочевидных решений для построения сильной типизации… вне рантайма.</li>
</ol><br/>
<p><strong>Что мы выиграли:</strong></p><br/>
<ol>
<li>При изменении интерфейса отваливается весь код, включая валидатор;</li>
<li>В редакторе появились подсказки по именам свойств и типам значений объекта для написания валидатора;</li>
<li>Отсутствие непонятных сторонних библиотек для тех же целей;</li>
<li>Правила Joi будут применяться только там, где это нужно, в остальных случаях — дефолтные типы;</li>
<li>Если кто-то захочет поменять тип значения какого-то свойства, то при правильной организации кода, он попадёт в то место, где вместе собраны все типы, связанные с этим свойством;</li>
<li>Научились красиво и просто скрывать дженерики за абстракцией <code>type</code>, визуально разгружая код от монструзоных конструкций.</li>
</ol><br/>
<p><strong>Мораль:</strong> Опыт бесценен, для остального есть карта "Мир".</p><br/>
<p>Посмотреть, пощупать, запустить итоговый результат можно:<br/>
<a href="https://repl.it/@Melodyn/Joi-by-interface">https://repl.it/@Melodyn/Joi-by-interface</a><br/>
<img src="https://i01.fotocdn.net/s27/157/public_pin_m/250/2670655900.jpg" alt="туть" title="туть" data-src="https://i01.fotocdn.net/s27/157/public_pin_m/250/2670655900.jpg" data-blurred="true"/></p></div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Btypescript%5D" class="tm-tags-list__link">typescript</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Binterface%5D" class="tm-tags-list__link">interface</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bjoi%5D" class="tm-tags-list__link">joi</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bvalidator%5D" class="tm-tags-list__link">validator</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/javascript/" class="tm-hubs-list__link">
    JavaScript
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/typescript/" class="tm-hubs-list__link">
    TypeScript
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 14: ↑13 и ↓1</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 14: ↑13 и ↓1" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+12</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">9.9K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    32
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/melodyn/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/7ae/567/2ef/7ae5672ef960b29a3972ce112f9a7ede.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 27 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    13
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Сергей Мелодин</span> <a href="/ru/users/melodyn/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @melodyn
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Backend web-developer</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <button type="submit" class="tm-user-card__button btn btn_transparent btn_small">
      Задонатить
    </button> <!----> <!----></div></div> <div class="tm-article-author__user-contacts"><a href="https://melodyn.ru" rel="noopener" target="_blank" class="tm-article-author__contact">
      Сайт
    </a></div></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/450238/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 17 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/450238/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/450238/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"450238":{"id":"450238","timePublished":"2019-05-01T03:59:11+00:00","isCorporative":false,"lang":"ru","titleHtml":"Валидация по TypeScript interface с использованием Joi","leadData":{"textHtml":"\u003Cp\u003EИстория о том, как потратить два дня на многократное переписывание одного и того же кода.\u003C\u002Fp\u003E\u003Cbr\u003E\r\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fkv\u002Fdo\u002Feq\u002Fkvdoeq2qi2shhsd1gtl76hjorvs.png\" alt=\"Joi &amp; TypeScript. A love story\" title=\"Joi &amp; TypeScript. A love story\"\u003E\u003C\u002Fp\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"scoreStats":{"score":13,"votesCount":27},"rating":0,"relatedData":null,"contacts":[{"title":"Сайт","url":"https:\u002F\u002Fmelodyn.ru","value":"https:\u002F\u002Fmelodyn.ru"}],"authorContacts":[{"title":"Сайт","url":"https:\u002F\u002Fmelodyn.ru","value":"https:\u002F\u002Fmelodyn.ru"}],"paymentDetails":{"paymentYandexMoney":"410013612708921","paymentPayPalMe":null,"paymentWebmoney":null},"id":"1587321","alias":"melodyn","fullname":"Сергей Мелодин","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F7ae\u002F567\u002F2ef\u002F7ae5672ef960b29a3972ce112f9a7ede.png","speciality":"Backend web-developer"},"statistics":{"commentsCount":17,"favoritesCount":32,"readingCount":9854,"score":12,"votesCount":14},"hubs":[{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true},{"relatedData":null,"id":"21370","alias":"typescript","type":"collective","title":"TypeScript","titleHtml":"TypeScript","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cp\u003EИстория о том, как потратить два дня на многократное переписывание одного и того же кода.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Joi &amp; TypeScript. A love story\" title=\"Joi &amp; TypeScript. A love story\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fkv\u002Fdo\u002Feq\u002Fkvdoeq2qi2shhsd1gtl76hjorvs.png\"\u002F\u003E\u003C\u002Fp\u003E\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ch1 id=\"vstuplenie\"\u003EВступление\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ рамках данной статьи опущу подробности про Hapi, Joi, роутинг и \u003Ccode\u003Evalidate: { payload: ... }\u003C\u002Fcode\u003E, подразумевая, что вы уже понимаете о чём речь, как и терминологию, а-ля \"интерфейсы\", \"типы\" и тому подобное. Расскажу лишь о пошаговой, не самой удачной стратегии, своего обучения этим вещам.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"nemnogo-predystorii\"\u003EНемного предыстории\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EСейчас я единственный backend разработчик (именно, пишущий код) на проекте. Функциональность — не суть, но ключевая сущность — это довольно длинная анкета с личными данными. Скорость работы и качество кода завязано на моём малом опыте самостоятельной работы над проектами с нуля, ещё более малом опыте работы с JS (всего 4й месяц) и попутно, очень криво-косо, пишу на TypeScript (далее — TS). Сроки сжаты, булки сжаты, постоянно прилетают правки и получается сначала писать код бизнес-логики, а потом сверху интерфейсы. Тем не менее, технический долг способен догнать и настучать по шапке, что, примерно, с нами и случилось.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПосле 3х месяцев работы над проектом, договорился наконец с коллегами о переходе на единый словарь, чтобы везде свойства объекта назывались и писались одинаково. Под это дело, разумеется, взялся писать интерфейс и плотно застрял с ним на два рабочих дня.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch1 id=\"problema\"\u003EПроблема\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВ качестве абстрактного примера выступит простая анкета пользователя.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Cstrong\u003E\u003Cdel\u003EПервый\u003C\u002Fdel\u003E Нулевой шаг хорошего разработчика:\u003C\u002Fstrong\u003E \u003Cdel\u003Eописать данные\u003C\u002Fdel\u003E написать тесты;\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cstrong\u003EПервый шаг:\u003C\u002Fstrong\u003E \u003Cdel\u003Eнаписать тесты\u003C\u002Fdel\u003E описать данные;\u003C\u002Fli\u003E\r\n\u003Cli\u003Eну и так далее.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДопустим, на этот код уже написаны тесты, осталось описать данные:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Einterface IUser {\n  name: string; \n  age: number;\n  phone: string | number;\n}\n\nconst aleg: IUser = {\n  name: 'Aleg',\n  age: 45,\n  phone: '79001231212'\n};\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЧтож, тут всё понятно и предельно просто. Весь этот код, как мы помним, на бэкэнде, а точнее, в api, то есть пользователь создаётся на основе данных, которые пришли по сети. Таким образом, нам нужно сделать валидацию входящих данных и поможет в этом Joi:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Econst joiUserValidator = {\n  name: Joi.string(),\n  age: Joi.number(),\n  phone: Joi.alternatives([Joi.string(), Joi.number()])\n};\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EРешение \"в лоб\" готово. Очевидный минус такого подхода — валидатор полностью оторван от интерфейса. Если в процессе жизни приложения изменятся \u002F добавятся поля или поменяется их тип, то данное изменение надо будет вручную отследить и указать в валидаторе. Думаю, таких ответственных разработчиков не будет до тех пор, пока что-то не упадёт. Кроме того, в нашем проекте, анкета состоит из 50+ полей на трёх уровнях вложенности и разбираться в этом крайне сложно, даже зная всё наизусть.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПросто указать \u003Ccode\u003Econst joiUserValidator: IUser\u003C\u002Fcode\u003E мы не можем, потому что \u003Ccode\u003EJoi\u003C\u002Fcode\u003E использует свои типы данных, что порождает при компиляции ошибки вида \u003Ccode\u003EType 'NumberSchema' is not assignable to type 'number'\u003C\u002Fcode\u003E. Но ведь должен быть способ выполнить валидацию по интерфейсу?\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fc86\u002F32b\u002Fef0\u002Fc8632bef03e0bc08cb00b9040e05dd8c.jpg\" alt=\"Я вышел в интернет с таким вопросом\" title=\"Я вышел в интернет с таким вопросом\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Fc86\u002F32b\u002Fef0\u002Fc8632bef03e0bc08cb00b9040e05dd8c.jpg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EВозможно, я неправильно гуглил, или плохо изучал ответы, но все решения сводились к либе \u003Ccode\u003EextractTypes\u003C\u002Fcode\u003E и каким-то лютым велосипедам, типа \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fhapijs\u002Fjoi\u002Fissues\u002F1557\"\u003Eтакого\u003C\u002Fa\u003E:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Etype ValidatedValueType&lt;T extends joi.Schema\u003E = T extends joi.StringSchema\n  ? string\n  : T extends joi.NumberSchema\n    ? number\n    : T extends joi.BooleanSchema\n      ? boolean\n      : T extends joi.ObjectSchema ? ValidatedObjectType&lt;T\u003E : \n      \u002F* ... more schemata ... *\u002F never;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch1 id=\"reshenie\"\u003EРешение\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"ispolzovat-storonnie-biblioteki\"\u003EИспользовать сторонние библиотеки\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПочему бы нет. Когда я вопрошал к людям со своей задачей, то получил в одном из ответов, а позже, и тут, в комментариях (спасибо \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fusers\u002Fkeenondrums\u002F\" class=\"user_link\"\u003Ekeenondrums\u003C\u002Fa\u003E ), ссылки на данные библиотеки:\u003Cbr\u002F\u003E\r\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ftypestack\u002Fclass-validator\"\u003Ehttps:\u002F\u002Fgithub.com\u002Ftypestack\u002Fclass-validator\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Ftypestack\u002Fclass-transformer\"\u003Ehttps:\u002F\u002Fgithub.com\u002Ftypestack\u002Fclass-transformer\u003C\u002Fa\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EОднако, был интерес разобраться самому, понять лучше работу TS, да и ничего не поджимало решить задачу сиюминутно.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"poluchit-vse-svoystva\"\u003EПолучить все свойства\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПоскольку со статикой ранее дел я не имел, вышеуказанный код открыл Америку в плане применения тернарных операторов в типах. К счастью, применить его в проекте не удалось. Зато нашёл другой интересный велосипед:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Einterface IUser {\n  name: string; \n  age: number;\n  phone: string | number;\n}\n\ntype UserKeys&lt;T\u003E = {\n  [key in keyof T];\n}\n\nconst evan: UserKeys&lt;IUser\u003E = {\n  name: 'Evan',\n  age: 32,\n  phone: 791234567890\n};\n\nconst joiUser: UserKeys&lt;IUser\u003E = {\n  name: Joi.string(),\n  age: Joi.number(),\n  phone: Joi.alternatives([Joi.string(), Joi.number()])\n};\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Ccode\u003ETypeScript\u003C\u002Fcode\u003E при довольно хитрых и загадочных условиях позволяет получить, например, ключи из интерфейса, словно это нормальный JS-объект, правда, только в конструкции \u003Ccode\u003Etype\u003C\u002Fcode\u003E и через \u003Ccode\u003Ekey in keyof T\u003C\u002Fcode\u003E и только через дженерики. В результате работы типа \u003Ccode\u003EUserKeys\u003C\u002Fcode\u003E, у всех объектов, реализующих интерфейсы, должен быть одинаковый набор свойств, но при этом типы значений могут быть произвольные. Это включает подсказки в IDE, но всё ещё не даёт однозначно обозначить типы значений.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EЗдесь есть ещё один интересный кейс, который не смог использовать. Возможно, вы подскажете зачем это нужно (хотя я частично догадываюсь, не хватает прикладного примера):\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Einterface IUser {\n  name: string; \n  age: number;\n  phone: string | number;\n}\n\ninterface IUserJoi {\n  name: Joi.StringSchema,\n  age: Joi.NumberSchema,\n  phone: Joi.AlternativesSchema\n}\n\ntype UserKeys&lt;T\u003E = {\n  [key in keyof T]: T[key];\n}\n\nconst evan: UserKeys&lt;IUser\u003E = {\n  name: 'Evan',\n  age: 32,\n  phone: 791234567890\n};\n\nconst userJoiValidator: UserKeys&lt;IUserJoi\u003E = {\n  name: Joi.string(),\n  age: Joi.number(),\n  phone: Joi.alternatives([Joi.string(), Joi.number()])\n};\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"ispolzovat-variativnye-tipy\"\u003EИспользовать вариативные типы\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EМожно явно задать типы, а используя \"ИЛИ\" и извлечение свойств, получить локально работоспособный код:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Etype TString = string | Joi.StringSchema;\ntype TNumber = number | Joi.NumberSchema;\ntype TStdAlter = TString | TNumber;\ntype TAlter = TStdAlter | Joi.AlternativesSchema;\n\nexport interface IUser {\n  name: TString;\n  age: TNumber;\n  phone: TAlter;\n}\n\ntype UserKeys&lt;T\u003E = {\n  [key in keyof T];\n}\n\nconst olex: UserKeys&lt;IUser\u003E = {\n  name: 'Olex',\n  age: 67,\n  phone: '79998887766'\n};\n\nconst joiUser: UserKeys&lt;IUser\u003E = {\n  name: Joi.string(),\n  age: Joi.number(),\n  phone: Joi.alternatives([Joi.string(), Joi.number()])\n};\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПроблема этого кода проявляется когда мы хотим забрать валидный объект, например, из базы, то есть TS заранее не знает какого типа данные будут — простые или Joi. Это может вызвать ошибку при попытке выполнить математические операции с полем, которое ожидается как \u003Ccode\u003Enumber\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Econst someUser: IUser = getUserFromDB({ name: 'Aleg' });\nconst someWeirdMath = someUser.age % 10; \u002F\u002F error TS2362: The left-hand side of an arithmetic operation must be of type'any', 'number', 'bigint' or an enum type\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДанная ошибка приходит из \u003Ccode\u003EJoi.NumberSchema\u003C\u002Fcode\u003E потому что возраст может быть не только \u003Ccode\u003Enumber\u003C\u002Fcode\u003E. За что боролись на то и напоролись.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2 id=\"soedinit-dva-resheniya-v-odno\"\u003EСоединить два решения в одно?\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EГде-то к этому моменту рабочий день подходил к логическому завершению. Я перевёл дух, выпил кофе и стёр эту порнографию к чертям. Надо меньше читать эти ваши интернеты! Настало время \u003Cdel\u003Eвзять дробовик и\u003C\u002Fdel\u003E пораскинуть мозгами:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EОбъект должен формироваться с явными типами значений;\u003C\u002Fli\u003E\r\n\u003Cli\u003EМожно использовать дженерики, чтобы прокидывать типы в один интерфейс;\u003C\u002Fli\u003E\r\n\u003Cli\u003EДженерики поддерживают типы по умолчанию;\u003C\u002Fli\u003E\r\n\u003Cli\u003EКонструкция \u003Ccode\u003Etype\u003C\u002Fcode\u003E явно способна на что-то ещё.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПишем интерфейс-дженерик с типами по умолчанию:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Einterface IUser\n&lt;\n  TName = string,\n  TAge = number,\n  TAlt = string | number\n\u003E {\n  name: TName; \n  age: TAge;\n  phone: TAlt;\n}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EДля Joi можно было бы создать второй интерфейс, наследовав основной таким образом:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Einterface IUserJoi extends IUser\n&lt;\n  Joi.StringSchema,\n  Joi.NumberSchema,\n  Joi.AlternativesSchema\n\u003E {}\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EНедостаточно хорошо, ведь следующий разработчик может с лёгким сердцем расширить \u003Ccode\u003EIUserJoi\u003C\u002Fcode\u003E или что похуже. Более ограниченный вариант получить похожее поведение:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Etype IUserJoi = IUser&lt;Joi.StringSchema, Joi.NumberSchema, Joi.AlternativesSchema\u003E;\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПробуем:\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Econst aleg: IUser = {\n  name: 'Aleg',\n  age: 45,\n  phone: '79001231212'\n};\n\nconst joiUser: IUserJoi = {\n  name: Joi.string(),\n  age: Joi.number(),\n  phone: Joi.alternatives([Joi.string(), Joi.number()])\n};\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003EUPD:\u003C\u002Fstrong\u003E\u003Cbr\u002F\u003E\r\nДля оборачивания в \u003Ccode\u003EJoi.object\u003C\u002Fcode\u003E пришлось побороться с ошибкой \u003Ccode\u003ETS2345\u003C\u002Fcode\u003E и самым простым решение оказался \u003Ccode\u003Eas any\u003C\u002Fcode\u003E. Думаю, это не критичное допущение, ведь выше объект всё равно по интерфейсу.\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Econst joiUserInfo = {\n  info: Joi.object(joiUser as any).required()\n};\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EКомпилится, на месте использования выглядит аккуратно и при отсутствии особых условий всегда устанавливает типы по умолчанию! Красота…\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw780q1\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Ff8c\u002F4c4\u002F96b\u002Ff8c4c496b545e0d6bd4a249feda9095f.jpg\" alt=\"печаль-беда\" title=\"печаль-беда\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fpost_images\u002Ff8c\u002F4c4\u002F96b\u002Ff8c4c496b545e0d6bd4a249feda9095f.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cbr\u002F\u003E\r\n… на что я потратил два рабочих дня\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Ch1 id=\"rezyumirovanie\"\u003EРезюмирование\u003C\u002Fh1\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003EКакие выводы из всего этого можно сделать:\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EОчевидно, я не научился находить ответы на вопросы. Наверняка при удачном запросе это решение (а то и ещё лучше) находится в первой 5ке ссылок поисковика;\u003C\u002Fli\u003E\r\n\u003Cli\u003EПереключиться на статическое мышление с динамического не так просто, гораздо чаще я просто забиваю на такое копошение;\u003C\u002Fli\u003E\r\n\u003Cli\u003EДженерики — крутая штука. На хабре и стековерфлоу полно \u003Cdel\u003Eвелосипедов\u003C\u002Fdel\u003E неочевидных решений для построения сильной типизации… вне рантайма.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003EЧто мы выиграли:\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EПри изменении интерфейса отваливается весь код, включая валидатор;\u003C\u002Fli\u003E\r\n\u003Cli\u003EВ редакторе появились подсказки по именам свойств и типам значений объекта для написания валидатора;\u003C\u002Fli\u003E\r\n\u003Cli\u003EОтсутствие непонятных сторонних библиотек для тех же целей;\u003C\u002Fli\u003E\r\n\u003Cli\u003EПравила Joi будут применяться только там, где это нужно, в остальных случаях — дефолтные типы;\u003C\u002Fli\u003E\r\n\u003Cli\u003EЕсли кто-то захочет поменять тип значения какого-то свойства, то при правильной организации кода, он попадёт в то место, где вместе собраны все типы, связанные с этим свойством;\u003C\u002Fli\u003E\r\n\u003Cli\u003EНаучились красиво и просто скрывать дженерики за абстракцией \u003Ccode\u003Etype\u003C\u002Fcode\u003E, визуально разгружая код от монструзоных конструкций.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003E\u003Cstrong\u003EМораль:\u003C\u002Fstrong\u003E Опыт бесценен, для остального есть карта \"Мир\".\u003C\u002Fp\u003E\u003Cbr\u002F\u003E\r\n\u003Cp\u003EПосмотреть, пощупать, запустить итоговый результат можно:\u003Cbr\u002F\u003E\r\n\u003Ca href=\"https:\u002F\u002Frepl.it\u002F@Melodyn\u002FJoi-by-interface\"\u003Ehttps:\u002F\u002Frepl.it\u002F@Melodyn\u002FJoi-by-interface\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fi01.fotocdn.net\u002Fs27\u002F157\u002Fpublic_pin_m\u002F250\u002F2670655900.jpg\" alt=\"туть\" title=\"туть\" data-src=\"https:\u002F\u002Fi01.fotocdn.net\u002Fs27\u002F157\u002Fpublic_pin_m\u002F250\u002F2670655900.jpg\" data-blurred=\"true\"\u002F\u003E\u003C\u002Fp\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"typescript"},{"titleHtml":"interface"},{"titleHtml":"joi"},{"titleHtml":"validator"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F450238\u002F841450cfe73cbc0adc19a639aade25c1\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F450238\u002F841450cfe73cbc0adc19a639aade25c1\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F450238\\\u002F\"},\"headline\":\"Валидация по TypeScript interface с использованием Joi\",\"datePublished\":\"2019-05-01T06:59:11+03:00\",\"dateModified\":\"2019-05-07T10:55:36+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Сергей Мелодин\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"История о том, как потратить два дня на многократное переписывание одного и того же кода.  Вступление В рамках данной статьи опущу подробности про Hapi, Joi, роу...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F450238\\\u002F#post-content-body\",\"about\":[\"h_javascript\",\"h_typescript\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fkv\\\u002Fdo\\\u002Feq\\\u002Fkvdoeq2qi2shhsd1gtl76hjorvs.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Fc86\\\u002F32b\\\u002Fef0\\\u002Fc8632bef03e0bc08cb00b9040e05dd8c.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fgetpro\\\u002Fhabr\\\u002Fpost_images\\\u002Ff8c\\\u002F4c4\\\u002F96b\\\u002Ff8c4c496b545e0d6bd4a249feda9095f.jpg\",\"https:\\\u002F\\\u002Fi01.fotocdn.net\\\u002Fs27\\\u002F157\\\u002Fpublic_pin_m\\\u002F250\\\u002F2670655900.jpg\"]}","metaDescription":"История о том, как потратить два дня на многократное переписывание одного и того же кода.\r\n\r\nВступление\r\nВ рамках данной статьи опущу подробности про Hapi, Joi, роутинг и validate: { payload: ... },...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"javascript,typescript"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
