<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
  <title>Представляем «CLI Builder»‎-ы / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.c0af73e7.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.e7843cc0.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.02ee25a4.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.85eb77f0b17c8235e7b64b9f81ea5ec2.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true" data-vmid="checkad"></script><script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/post\/450746\/"},"headline":"Представляем «CLI Builder»‎-ы","datePublished":"2019-05-14T02:09:25+03:00","dateModified":"2019-05-14T10:28:15+03:00","author":{"@type":"Person","name":"Fedor Usakov"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"В этой статье мы рассмотрим новый API Angular CLI, который позволит вам расширять существующие возможности CLI и добавлять новые. Мы обсудим, как работать с эт...","url":"https:\/\/habr.com\/ru\/post\/450746\/#post-content-body","about":["h_javascript","h_angular","h_typescript","f_develop"],"image":["https:\/\/habrastorage.org\/webt\/sm\/xo\/kb\/smxokbjs_uhwjcb1rjv7cwt5k3m.png"]}</script>
  <script src="//www.googletagservices.com/tag/js/gpt.js" async></script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.49.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_eng"><meta data-vue-meta="ssr" property="og:title" content="Представляем «CLI Builder»‎-ы" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="Представляем «CLI Builder»‎-ы" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="Представляем «CLI Builder»‎-ы" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="В этой статье мы рассмотрим новый API Angular CLI, который позволит вам расширять существующие возможности CLI и добавлять новые. Мы обсудим, как работать с этим API, и какие существуют точки его..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="В этой статье мы рассмотрим новый API Angular CLI, который позволит вам расширять существующие возможности CLI и добавлять новые. Мы обсудим, как работать с этим API, и какие существуют точки его..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="В этой статье мы рассмотрим новый API Angular CLI, который позволит вам расширять существующие возможности CLI и добавлять новые. Мы обсудим, как работать с этим API, и какие существуют точки его..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="В этой статье мы рассмотрим новый API Angular CLI, который позволит вам расширять существующие возможности CLI и добавлять новые. Мы обсудим, как работать с этим API, и какие существуют точки его..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="В этой статье мы рассмотрим новый API Angular CLI, который позволит вам расширять существующие возможности CLI и добавлять новые. Мы обсудим, как работать с этим API, и какие существуют точки его..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habr.com/share/publication/450746/da008bdff0e49f014e1c5bd86a7bd00a/" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habr.com/share/publication/450746/da008bdff0e49f014e1c5bd86a7bd00a/" data-vmid="og:image"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habr.com/share/publication/450746/da008bdff0e49f014e1c5bd86a7bd00a/" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habr.com/share/publication/450746/da008bdff0e49f014e1c5bd86a7bd00a/" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habr.com/share/publication/450746/da008bdff0e49f014e1c5bd86a7bd00a/" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="450746" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2019-05-13T23:09:25.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/post/450746/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/post/450746/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" data-vmid="hreflang"><link data-vue-meta="ssr" image_src="image" href="https://habr.com/share/publication/450746/da008bdff0e49f014e1c5bd86a7bd00a/" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <!----> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><!----> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <div class="tm-dropdown tm-header__projects"><div class="tm-dropdown__head"><button class="tm-header__dropdown-toggle"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon_dropdown"><title>Открыть список</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#arrow-down"></use></svg></button></div> <!----></div> <a href="/ru/sandbox/start/" class="tm-header__become-author-btn">
            Как стать автором
          </a> <div class="tm-feature tm-header__feature tm-feature_variant-inline"><!----></div> <!----> <!----></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <div data-menu-sticky="true" class="tm-base-layout__header tm-base-layout__header_is-sticky"><div class="tm-page-width"><div class="tm-base-layout__header-wrapper"><div class="tm-main-menu"><div class="tm-main-menu__section"><nav class="tm-main-menu__section-content"><!----> <a href="/ru/all/" class="tm-main-menu__item">
        Все потоки
      </a> <a href="/ru/flows/develop/" class="tm-main-menu__item">
          Разработка
        </a><a href="/ru/flows/admin/" class="tm-main-menu__item">
          Администрирование
        </a><a href="/ru/flows/design/" class="tm-main-menu__item">
          Дизайн
        </a><a href="/ru/flows/management/" class="tm-main-menu__item">
          Менеджмент
        </a><a href="/ru/flows/marketing/" class="tm-main-menu__item">
          Маркетинг
        </a><a href="/ru/flows/popsci/" class="tm-main-menu__item">
          Научпоп
        </a></nav></div></div> <div class="tm-header-user-menu tm-base-layout__user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search tm-header-user-menu__icon_dark"><title>Поиск</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item tm-header-user-menu__user_desktop"><div class="tm-dropdown"><div class="tm-dropdown__head"><svg height="24" width="24" data-test-id="menu-toggle-guest" class="tm-svg-img tm-header-user-menu__icon"><title>Профиль</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#header-user"></use></svg> <!----></div> <!----></div> <!----></div> <!----></div></div></div></div> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" data-async-called="true" class="tm-page"><div class="tm-page-width"><!----> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/ScarletFlash/" title="ScarletFlash" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt="" height="24" loading="lazy" src="//habrastorage.org/r/w32/getpro/habr/avatars/3b6/c91/862/3b6c918620526c49391af54ac03cea3e.png" width="24" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user"><a href="/ru/users/ScarletFlash/" class="tm-user-info__username">
      ScarletFlash
    </a> </span></span> <span class="tm-article-snippet__datetime-published"><time datetime="2019-05-13T23:09:25.000Z" title="2019-05-14, 02:09">14  мая  2019 в 02:09</time></span></div> <!----></div> <h1 lang="ru" class="tm-article-snippet__title tm-article-snippet__title_h1"><span>Представляем «CLI Builder»‎-ы</span></h1> <div class="tm-article-snippet__hubs"><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/javascript/" class="tm-article-snippet__hubs-item-link"><span>JavaScript</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/angular/" class="tm-article-snippet__hubs-item-link"><span>Angular</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-article-snippet__hubs-item"><a href="/ru/hub/typescript/" class="tm-article-snippet__hubs-item-link"><span>TypeScript</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span></div> <div class="tm-article-snippet__labels"><div class="tm-article-snippet__label"><span>
        Перевод
      </span></div></div> <!----> <!----></div></div> <div class="tm-article-presenter__origin"><a href="https://blog.angular.io/d012d4489f1b" target="_blank" class="tm-article-presenter__origin-link">
                Автор оригинала:
                <span>
                  Hans Larsen
                </span></a></div> <div data-gallery-root="" lang="ru" class="tm-article-body"><div id="post-content-body" class="article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><img src="/img/image-loader.svg" alt="Представляем «CLI Builder»‎-ы" data-src="https://habrastorage.org/webt/sm/xo/kb/smxokbjs_uhwjcb1rjv7cwt5k3m.png"/><br/>
<br/>
В этой статье мы рассмотрим новый API Angular CLI, который позволит вам расширять существующие возможности CLI и добавлять новые. Мы обсудим, как работать с этим API, и какие существуют точки его расширения, позволяющие добавлять новый функционал в CLI.<br/>
<a name="habracut"></a><br/>
<h2>История</h2><br/>
Около года назад мы представили файл рабочей области (<i>angular.json</i>) в Angular CLI и переосмыслили многие базовые принципы реализации его команд. Мы пришли к тому, что разместили команды в «коробках»:<br/>
<br/>
<ol>
<li><b>Schematic commands – «Схематические команды»</b>. К настоящему времени, вероятно, вы уже слышали о Schematics – библиотеке, используемой CLI для генерации и изменения вашего кода. Она появилась в 5-й версии и, в настоящее время, используется в большинстве команд, которые касаются вашего кода, таких, как <i>new</i>, <i>generate</i>, <i>add</i> и <i>update</i>.</li>
<li><b>Miscellaneous commands – «Прочие команды»</b>. Это команды, которые не относятся непосредственно к вашему проекту: <i>help</i>, <i>version</i>, <i>config</i>, <i>doc</i>. Недавно появилась ещё <i>analytics</i>, а также наши пасхалки (Тссс! Никому ни слова!).</li>
<li><b>Task commands – «Команды задач»</b>. Эта категория, по большому счету, «запускает процессы, выполняемые над кодом других людей». – Как пример, <i>build</i> – сборка проекта, <i>lint</i> – отладка и <i>test</i> – тестирование.</li>
</ol><br/>
Мы начали проектировать <i>angular.json</i> довольно давно. Изначально, он был задуман как замена Webpack-конфигурации. Кроме того, он должен был позволить разработчикам самостоятельно выбирать реализацию сборки проекта. В итоге, у нас получилась базовая система запуска задач, которая оставалась простой и удобной для наших экспериментов. Мы назвали этот API «Architect».<br/>
<br/>
Несмотря на то, что Architect официально не поддерживался, он пользовался популярностью среди разработчиков, которые хотели настраивать сборку проектов, а также, среди сторонних библиотек, которым было необходимо контролировать их workflow. Nx использовал его для выполнения команд Bazel, Ionic использовал его для запуска unit-тестов на Jest, а пользователи могли расширять свои конфигурации Webpack-ов с помощью таких инструментов, как <a href="https://www.npmjs.com/package/ngx-build-plus">ngx-build-plus</a>. И это было только начало.<br/>
<br/>
<b>Официально поддерживаемая, стабилизированная и улучшенная версия этого API используется в Angular CLI версии 8.</b><br/>
<br/>
<h2>Концепция</h2><br/>
Architect API предлагает инструменты для планирования и координации задач, которые используются в Angular CLI для реализации его команд. Он использует функции, называемые <br/>
«builder»-ами – «сборщиками», которые могут выступать в роли задач или же планировщиков других сборщиков. Кроме того, он использует angular.json в качестве набора инструкций для самих сборщиков.<br/>
<br/>
Это очень общая система, созданная для того, чтобы быть гибкой и расширяемой. Она содержит API для построения отчетов, ведения логов и тестирования. При необходимости, систему можно расширять для новых задач.<br/>
<br/>
<h2>Сборщики</h2><br/>
Сборщики – это функции, реализующие логику и поведение для задачи, которая может заменить команду CLI. – Например, запустить линтер.<br/>
<br/>
Функция сборщика принимает два аргумента: входное значение (или опции) и контекст, который обеспечивает взаимосвязь между CLI и самим сборщиком. Разделение ответственности здесь такое же, как в Schematics – опции задает пользователь CLI, за контекст отвечает API, а вы (разработчик) устанавливаете необходимое поведение. Поведение может быть реализовано синхронно, асинхронно, либо же просто выводить определенное количество значений. Вывод обязательно должен иметь тип <i>BuilderOutput</i>, содержащий логическое поле <i>success</i> и необязательное поле <i>error</i>, содержащее сообщение об ошибке.<br/>
<br/>
<h2>Файл рабочей области и задачи</h2><br/>
Architect API полагается на <i>angular.json</i> – файл рабочей области, для хранения задач и их настроек.<br/>
<br/>
<i>angular.json</i> делит рабочую область на проекты, а их, в свою очередь, на задачи. Например, ваше приложение, созданное с помощью команды <i>ng new</i>, это один из таких проектов. Одной из задач в этом проекте будет задача <i>build</i>, которую можно запустить с помощью команды <i>ng build</i>. По-умолчанию, эта задача имеет три ключа:<br/>
<br/>
<ol>
<li><b>builder</b> – имя сборщика, который необходимо использовать для выполнения задачи, в формате <i>НАЗВАНИЕ_ПАКЕТА: НАЗВАНИЕ_СБОРЩИКА</i>.</li>
<li><b>options</b> – настройки, используемые при запуске задачи по-умолчанию.</li>
<li><b>configurations</b> – настройки, которые применятся при запуске задачи с указанной конфигурацией.</li>
</ol><br/>
Настройки применяются следующим образом: когда запускается задача, настройки берутся из блока options, затем, если была указана конфигурация, её настройки записываются поверх существующих. После этого, если в <i>scheduleTarget()</i> были переданы дополнительные настройки – блок <i>overrides</i>, они запишутся последними. При использовании Angular CLI, в <i>overrides</i> передаются аргументы командной строки. После того, как все настройки переданы сборщику, он проверяет их по своей схеме, и только, если настройки ей соответствуют, будет создан контекст, а сборщик начнет работу.<br/>
<br/>
Дополнительная информация о рабочей области <a href="https://angular.io/guide/workspace-config">здесь</a>.<br/>
<br/>
<h2>Создание собственного сборщика</h2><br/>
В качестве примера, давайте создадим сборщик, который будет запускать команду в командной строке. Для создания сборщика, воспользуйтесь фабрикой <i>createBuilder</i> и верните объект <i>BuilderOutput</i>:<br/>
<br/>
<pre><code class="javascript">import { BuilderOutput, createBuilder } from '@angular-devkit/architect';

export default createBuilder((options, context) => {
  return new Promise&lt;BuilderOutput>(resolve => {
    resolve({ success: true });
  });
});
</code></pre><br/>
Теперь, давайте добавим немного логики в наш сборщик: мы хотим, контролировать сборщик через настройки, создавать новые процессы, ждать, пока процесс завершится и, если процесс завершился успешно (то есть, вернул код 0), сигнализировать об этом в Architect:<br/>
<br/>
<pre><code class="javascript">import { BuilderOutput, createBuilder } from '@angular-devkit/architect';
import * as childProcess from 'child_process';

export default createBuilder((options, context) => {
  const child = childProcess.spawn(options.command, options.args);
  return new Promise&lt;BuilderOutput>(resolve => {
    child.on('close', code => {
      resolve({ success: code === 0 });
    });
  });
});
</code></pre><br/>
<h2>Обработка вывода</h2><br/>
Сейчас, метод <i>spawn</i> передаёт все данные в стандартный вывод процесса. Мы же можем хотеть передавать их в <i>logger</i> – регистратор. В этом случае, во-первых, будет облегчена отладка при тестировании, а во-вторых, сам Architect может запускать наш сборщик в отдельном процессе или же отключать стандартный вывод процессов (например, в приложении Electron).<br/>
<br/>
Для этого, мы можем использовать <i>Logger</i>, доступный в объекте <i>context</i>, который позволит нам перенаправлять вывод процесса:<br/>
<br/>
<pre><code class="javascript">import { BuilderOutput, createBuilder } from '@angular-devkit/architect';
import * as childProcess from 'child_process';

export default createBuilder((options, context) => {
  const child = childProcess.spawn(options.command, options.args, { stdio: 'pipe' });
  child.stdout.on('data', (data) => {
    context.logger.info(data.toString());
  });
  child.stderr.on('data', (data) => {
    context.logger.error(data.toString());
  });

  return new Promise&lt;BuilderOutput>(resolve => {
    child.on('close', code => {
      resolve({ success: code === 0 });
    });
  });
});
</code></pre><br/>
<h2>Отчеты о выполнении и статусе</h2><br/>
Заключительная часть API, относящаяся к реализации вашего собственного сборщика – отчеты о выполнении и текущем статусе.<br/>
<br/>
В нашем случае, команда либо завершается, либо выполняется, поэтому нет смысла добавлять отчет о выполнении. Однако, мы можем сообщить наш статус родительскому сборщику, чтобы он понимал, что происходит.<br/>
<br/>
<pre><code class="javascript">import { BuilderOutput, createBuilder } from '@angular-devkit/architect';
import * as childProcess from 'child_process';

export default createBuilder((options, context) => {
  context.reportStatus(`Executing "${options.command}"...`);
  const child = childProcess.spawn(options.command, options.args, { stdio: 'pipe' });

  child.stdout.on('data', (data) => {
    context.logger.info(data.toString());
  });
  child.stderr.on('data', (data) => {
    context.logger.error(data.toString());
  });

  return new Promise&lt;BuilderOutput>(resolve => {
    context.reportStatus(`Done.`);
    child.on('close', code => {
      resolve({ success: code === 0 });
    });
  });
});
</code></pre><br/>
Чтобы передавать отчет о выполнении, используйте метод <i>reportProgress</i> с текущими и (необязательно) итоговыми значениями, в качестве аргументов. <i>total</i> может быть любым числом. Например, если вы знаете, сколько файлов вам нужно обработать, в <i>total</i> можно передать их количество, тогда в <i>current</i> можно передать число уже обработанных файлов. Именно так <a href="https://github.com/angular/angular-cli/blob/76492141d21649e1924a7a84a2af25ceca294be1/packages/angular_devkit/build_angular/src/tslint/index.ts">сборщик tslint</a> сообщает о своем прогрессе.<br/>
<br/>
<h2>Проверка входных значений</h2><br/>
Объект <i>options</i>, передаваемый в сборщик, проверяется с помощью JSON Schema. Это похоже на Schematics, если вы знаете, что это такое.<br/>
<br/>
В нашем примере сборщика, мы ожидаем, что наши параметры будут объектом, который получает два ключа: <i>command</i> – команду (строка) и <i>args</i> – аргументы (массив строк). Наша схема проверки будет выглядеть так:<br/>
<br/>
<pre><code class="json">{
  "$schema": "http://json-schema.org/schema",
  "type": "object",
  "properties": {
    "command": {
      "type": "string"
    },
    "args": {
      "type": "array",
      "items": {
        "type": "string"
      }
    }
  }
</code></pre><br/>
Схемы – действительно мощные инструменты, которые могут проводить большое количество проверок. Для получения дополнительной информации о схемах JSON, вы можете обратиться к <a href="http://json-schema.org/">официальному сайту JSON Schema</a>.<br/>
<br/>
<h2>Создание пакета сборщика</h2><br/>
Существует один ключевой файл, который необходимо создать для нашего собственного сборщика, чтобы сделать его совместимым с Angular CLI – <i>builders.json</i>, который отвечает за взаимосвязь нашей реализации сборщика, его имени и схемы проверки. Сам файл выглядит вот так:<br/>
<br/>
<pre><code class="json">{
  "builders": {
    "command": {
      "implementation": "./command",
      "schema": "./command/schema.json",
      "description": "Runs any command line in the operating system."
    }
  }
}
</code></pre><br/>
Затем, в файл <i>package.json</i> мы добавляем ключ <i>builders</i>, указывающий на файл <i>builders.json</i>: <br/>
<br/>
<pre><code class="json">{
  "name": "@example/command-runner",
  "version": "1.0.0",
  "description": "Builder for Architect",
  "builders": "builders.json",
  "devDependencies": {
    "@angular-devkit/architect": "^1.0.0"
  }
}
</code></pre><br/>
Это подскажет Architect, где искать файл определения сборщика.<br/>
<br/>
Таким образом название нашего сборщика – <i>"@example/command-runner:command"</i>. Первая часть названия, перед двоеточием (:) – название пакета, определяемое с помощью <i>package.json</i>. Вторая часть – название сборщика, определяемое с помощью файла <i>builders.json</i>.<br/>
<br/>
<h2>Тестирование собственных сборщиков</h2><br/>
Рекомендуемый способ тестирования сборщиков – интеграционное тестирование. Это связано с тем, что создать <i>context</i> непросто, поэтому вам стоит воспользоваться планировщиком от Architect.<br/>
<br/>
Чтобы упростить шаблоны, мы продумали простой способ создания экземпляра Architect: сначала вы создаете <i>JsonSchemaRegistry</i> (для проверки схемы), затем, <i>TestingArchitectHost</i> и, в конце концов, экземпляр <i>Architect</i>. Теперь вы можете составить файл конфигурации <i>builders.json</i>.<br/>
<br/>
Вот пример запуска сборщика, который выполняет команду <i>ls</i> и проверяет, что команда успешно выполнилась. Учтите, что мы будем пользоваться стандартным выводом процессов в <i>logger</i>.<br/>
<br/>
<pre><code class="javascript">import { Architect, ArchitectHost } from '@angular-devkit/architect';
import { TestingArchitectHost } from '@angular-devkit/architect/testing';
import { logging, schema } from '@angular-devkit/core';

describe('Command Runner Builder', () => {
  let architect: Architect;
  let architectHost: ArchitectHost;

  beforeEach(async () => {
    const registry = new schema.CoreSchemaRegistry();
    registry.addPostTransform(schema.transforms.addUndefinedDefaults);

    // Аргументы TestingArchitectHost – рабочая и текущая директории.
    // Сейчас мы их не используем, поэтому они одинаковые.
    architectHost = new TestingArchitectHost(__dirname, __dirname);
    architect = new Architect(architectHost, registry);

    // Тут мы передаем либо имя NPM-пакета,
    // либо путь до package.json файла пакета.
    await architectHost.addBuilderFromPackage('..');
  });

  // Это может не работать в Windows
  it('can run ls', async () => {
    // Создаем регистратор, хранящий массив всех зарегистрированных сообщений.
    const logger = new logging.Logger('');
    const logs = [];
    logger.subscribe(ev => logs.push(ev.message));

    // "run" может содержать множество выводов, а также информацию о ходе работы сборщика.
    const run = await architect.scheduleBuilder('@example/command-runner:command', {
      command: 'ls',
      args: [__dirname],
    }, { logger });

    // "result" – следующий вывод выполняемого процесса.
    // Он имеет тип "BuilderOutput".
    const output = await run.result;
    
    // Останавливаем сборщик. Architect действительно прекращает сохранение состояний 
    // сборщика в памяти, так как сборщики ждут, чтобы снова быть запущенными.
    await run.stop();

    // Ожидаем успешное завершение.
    expect(output.success).toBe(true);

    // Ожидаем, что этот файл будет выведен.
    // `ls $__dirname`.
    expect(logs).toContain('index_spec.ts');
  });
});
</code></pre><br/>
Чтобы запустить пример, указанный выше, вам потребуется пакет <i>ts-node</i>. Если вы собираетесь использовать Node, переименуйте <i>index_spec.ts</i> в <i>index_spec.js</i>.<br/>
<br/>
<h2>Использование сборщика в проекте</h2><br/>
Давайте создадим простой angular.json, демонстрирующий всё, что мы узнали про сборщики. Если предположить, что мы запаковали наш сборщик в <i><a href="https://habr.com/ru/users/example/" class="user_link">example</a>/command-runner</i>, а затем создали новое приложение с помощью <i>ng new builder-test</i>, файл <i>angular.json</i> может выглядеть так (часть содержимого была удалена для краткости):<br/>
<br/>
<pre><code class="json">{
  // ... удалено для краткости.
  "projects": {
    // ...
    "builder-test": {
      // ...
      "architect": {
        // ...
        "build": {
          "builder": "@angular-devkit/build-angular:browser",
          "options": {
            // ... разные опции
            "outputPath": "dist/builder-test",
            "index": "src/index.html",
            "main": "src/main.ts",
            "polyfills": "src/polyfills.ts",
            "tsConfig": "src/tsconfig.app.json"
          },
          "configurations": {
            "production": {
              // ... разные опции
              "optimization": true,
              "aot": true,
              "buildOptimizer": true
            }
          }
        }
      }
</code></pre><br/>
Если бы мы решили добавить новую задачу для применения (например) команды <i>touch</i> к файлу (обновляет дату изменения файла), с использованием нашего сборщика, мы бы выполнили <i>npm install <a href="https://habr.com/ru/users/example/" class="user_link">example</a>/command-runner</i>, а затем, внесли бы изменения в <i>angular.json</i>:<br/>
<br/>
<pre><code class="json">
{
  "projects": {
    "builder-test": {
      "architect": {
        "touch": {
          "builder": "@example/command-runner:command",
          "options": {
            "command": "touch",
            "args": [
              "src/main.ts"
            ]
          }
        },
        "build": {
          "builder": "@angular-devkit/build-angular:browser",
          "options": {
            "outputPath": "dist/builder-test",
            "index": "src/index.html",
            "main": "src/main.ts",
            "polyfills": "src/polyfills.ts",
            "tsConfig": "src/tsconfig.app.json"
          },
          "configurations": {
            "production": {
              "fileReplacements": [
                {
                  "replace": "src/environments/environment.ts",
                  "with": "src/environments/environment.prod.ts"
                }
              ],
              "optimization": true,
              "aot": true,
              "buildOptimizer": true
            }
          }
        }
      }
    }
  }
}
</code></pre><br/>
В Angular CLI есть команда <i>run</i>, которая является основной командой для запуска сборщиков. В качестве первого аргумента она принимает строку формата <i>ПРОЕКТ: ЗАДАЧА[: КОНФИГУРАЦИЯ]</i>. Чтобы запустить нашу задачу, мы можем воспользоваться командой <i>ng run builder-test:touch</i>.<br/>
<br/>
Теперь мы можем хотеть переопределить какие-то аргументы. К сожалению, пока мы не можем переопределять массивы из командной строки, однако мы можем изменить саму команду для демонстрации: <i>ng run builder-test:touch --command=ls</i>. – Это выведет файл <i>src/main.ts</i>.<br/>
<br/>
<h2>Watch Mode – режим наблюдения</h2><br/>
Предполагается, что по-умолчанию, сборщики будут вызываться единожды и завершаться, однако, они могут возвращать <i>Observable</i>, чтобы реализовывать собственный режим наблюдения (как это делает сборщик <i>Webpack</i>). Architect будет подписан на <i>Observable</i> до тех пор, пока он не завершится или не остановится и сможет подписаться на сборщик снова, если сборщик будет вызван с теми же параметрами (хоть и не гарантированно).<br/>
<br/>
<ol>
<li>Сборщик должен возвращать объект <i>BuilderOutput</i> после каждого выполнения. После завершения, он может войти в режим наблюдения, вызванный внешним событием и, если он запустится снова, он должен будет вызвать функцию <i>context.reportRunning()</i> для уведомления Architect о том, что сборщик снова работает. Это защитит сборщик от остановки его Architect-ом при новом вызове.</li>
<li>Architect сам отписывается от <i>Observable</i>, когда сборщик останавливается (с помощью run.stop(), например), с использованием <a href="http://reactivex.io/rxjs/class/es6/MiscJSDoc.js~TeardownLogicDoc.html">Teardown-логики</a> – алгоритма уничтожения. Это позволит вам останавливать и очищать сборку, если этот процесс уже запущен.</li>
</ol><br/>
Резюмируя вышесказанное, если ваш сборщик наблюдает за внешними событиями, он работает в три этапа:<br/>
<br/>
<ol>
<li><b>Выполнение.</b> Например, компиляция Webpack. Этот этап заканчивается, когда Webpack заканчивает сборку, а ваш сборщик отправляет <i>BuilderOutput</i> в <i>Observable</i>.</li>
<li><b>Наблюдение.</b> – Между двумя запусками ведется наблюдение за внешними событиями. Например, Webpack следит за файловой системой на предмет любых изменений. Этот этап заканчивается, когда Webpack возобновляет сборку и вызывается <i>context.reportRunning()</i>. После этого этапа снова начинается этап 1.</li>
<li><b>Завершение.</b> – Задача полностью выполнена (например, ожидалось, что Webpack запустится определенное количество раз) или запуск сборщика был остановлен (с помощью <i>run.stop()</i>). В этом случае, выполняется алгоритм уничтожения <i>Observable</i>, и он очищается.</li>
</ol><br/>
<h2>Заключение</h2><br/>
Вот, краткое изложение того, что мы узнали в этой публикации:<br/>
<br/>
<ol>
<li>Мы предоставляем новый API, который позволит разработчикам изменять поведение команд Angular CLI и добавлять новые, используя сборщики, реализующие необходимую логику.</li>
<li>Сборщики могут быть синхронными, асинхронными и реагирующими на внешние события. Они могут вызываться несколько раз, а также, вызывать другие сборщики.</li>
<li>Параметры, которые получает сборщик при запуске задачи, сначала считываются из файла <i>angular.json</i>, затем, перезаписываются параметрами из конфигурации, если она есть, а потом, перезаписываются флагами командной строки, если они были добавлены.</li>
<li>Рекомендованный способ тестирования сборщиков – интеграционные тесты, однако вы можете выполнять модульное тестирование отдельно от логики сборщика.</li>
<li>Если сборщик возвращает Observable, он должен очищаться после прохождения алгоритма уничтожения.</li>
</ol><br/>
В ближайшем будущем частота использования этих API будет увеличиваться. Например, реализация Bazel сильно с ними связана.<br/>
<br/>
Мы уже видим, как сообщество создает новые CLI сборщики для использования, например, <i><a href="https://github.com/meltedspark/angular-builders/tree/master/packages/jest">jest</a></i> и <i><a href="https://blog.nrwl.io/nrwl-nx-7-0-better-e2e-testing-with-cypress-1b88336bef5e">cypress</a></i> для тестирования.</div></div> <!----> <!----></div> <div class="tm-article-presenter__meta"><div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%81%D0%B1%D0%BE%D1%80%D1%89%D0%B8%D0%BA%5D" class="tm-tags-list__link">сборщик</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%84%D1%80%D0%BE%D0%BD%D1%82%D0%B5%D0%BD%D0%B4%5D" class="tm-tags-list__link">фронтенд</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%84%D1%80%D0%BE%D0%BD%D1%82%D0%B5%D0%BD%D0%B4-%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0%5D" class="tm-tags-list__link">фронтенд-разработка</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%84%D1%80%D0%BE%D0%BD%D1%82%D0%B5%D0%BD%D0%B4%20%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0%5D" class="tm-tags-list__link">фронтенд разработка</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%84%D1%80%D0%BE%D0%BD%D1%82%D0%B5%D0%BD%D0%B4-%D1%84%D1%80%D0%B5%D0%B9%D0%BC%D0%B2%D0%BE%D1%80%D0%BA%D0%B8%5D" class="tm-tags-list__link">фронтенд-фреймворки</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bangular%5D" class="tm-tags-list__link">angular</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Barchitect%5D" class="tm-tags-list__link">architect</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Barchitect%20api%5D" class="tm-tags-list__link">architect api</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bbuilder%5D" class="tm-tags-list__link">builder</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bcli%5D" class="tm-tags-list__link">cli</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bfrontend%5D" class="tm-tags-list__link">frontend</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bfrontend%20development%5D" class="tm-tags-list__link">frontend development</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bgoogle%5D" class="tm-tags-list__link">google</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bjavascript%5D" class="tm-tags-list__link">javascript</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bjavascript%20framework%5D" class="tm-tags-list__link">javascript framework</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Brxjs%5D" class="tm-tags-list__link">rxjs</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Btypescript%5D" class="tm-tags-list__link">typescript</a></li></ul></div> <div class="tm-separated-list tm-article-presenter__meta-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/hub/javascript/" class="tm-hubs-list__link">
    JavaScript
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/angular/" class="tm-hubs-list__link">
    Angular
  </a></li><li class="tm-separated-list__item"><a href="/ru/hub/typescript/" class="tm-hubs-list__link">
    TypeScript
  </a></li></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="16" width="16" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon_medium"><title>Всего голосов 10: ↑10 и ↓0</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-rating"></use></svg> <span title="Всего голосов 10: ↑10 и ↓0" class="tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_medium">+10</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <span title="Количество просмотров" class="tm-icon-counter tm-data-icons__item"><svg height="16" width="16" class="tm-svg-img tm-icon-counter__icon"><title>Просмотры</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-views"></use></svg> <span class="tm-icon-counter__value">4.3K</span></span> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span title="Добавить в закладки" class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    32
  </span></button> <!----> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="tm-sharing__icon"><path fill="currentColor" d="M10.33.275l9.047 7.572a.2.2 0 010 .306l-9.048 7.572a.2.2 0 01-.328-.153V11c-8 0-9.94 6-9.94 6S-1 5 10 5V.428a.2.2 0 01.328-.153z"></path></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div> </div></div> <!----> <!----> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <section class="tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"> <div class="tm-user-card tm-article-author__user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/ScarletFlash/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt="" src="//habrastorage.org/getpro/habr/avatars/3b6/c91/862/3b6c918620526c49391af54ac03cea3e.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 10 голосов " class="tm-karma tm-user-card__karma"><div class="tm-karma__votes tm-karma__votes_positive">
    2
  </div> <div class="tm-karma__text">
    Карма
  </div></div> <div title="Рейтинг пользователя" class="tm-rating tm-user-card__rating"><div class="tm-rating__header"> <div class="tm-rating__counter">0</div></div> <div class="tm-rating__text">
    Рейтинг
  </div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name_variant-article">Fedor Usakov</span> <a href="/ru/users/ScarletFlash/" class="tm-user-card__nickname tm-user-card__nickname_variant-article">
          @ScarletFlash
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info_variant-article">Frontend Tech Lead</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <div class="tm-article-author__user-contacts"><a href="https://scarletflash.dev" rel="noopener" target="_blank" class="tm-article-author__contact">
      Сайт
    </a></div></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/post/450746/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="16" width="16" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v24.ce74655c.svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 1 
    </span></a> <!----></div></div></div> <div class="tm-ad-banner__container tm-page-article__banner"><!----> <div id="articleBottomBanner" class="tm-ad-banner"></div></div> <!----> <!----> <!----> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><div class="tm-layout-sidebar"><div class="tm-layout-sidebar__ads tm-layout-sidebar__ads_initial"><div class="tm-ad-banner__container tm-layout-sidebar__banner"><!----> <div id="sidebarBanner" class="tm-ad-banner"></div></div></div> <div class="tm-sexy-sidebar tm-sexy-sidebar_initial" style="margin-top:0px;"><!----> <!----></div></div></div></div></div></div></main> <!----></div> <div class="tm-footer-menu"><div class="tm-page-width"><div class="tm-footer-menu__container"><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Ваш аккаунт
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr/?back=/ru/post/450746/&amp;hl=ru" rel="nofollow" target="_self">
                Войти
              </a></li><li class="tm-footer-menu__list-item"><a href="/kek/v1/auth/habrahabr-register/?back=/ru/post/450746/&amp;hl=ru" rel="nofollow" target="_self">
                Регистрация
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Разделы
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/" class="footer-menu__item-link router-link-active">
                Публикации
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/news/" class="footer-menu__item-link">
                Новости
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/hubs/" class="footer-menu__item-link">
                Хабы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/companies/" class="footer-menu__item-link">
                Компании
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/users/" class="footer-menu__item-link">
                Авторы
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/sandbox/" class="footer-menu__item-link">
                Песочница
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Информация
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="/ru/docs/help/" class="footer-menu__item-link">
                Устройство сайта
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/authors/codex/" class="footer-menu__item-link">
                Для авторов
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/companies/corpblogs/" class="footer-menu__item-link">
                Для компаний
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/docs/docs/transparency/" class="footer-menu__item-link">
                Документы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/agreement" target="_blank">
                Соглашение
              </a></li><li class="tm-footer-menu__list-item"><a href="https://account.habr.com/info/confidential/" target="_blank">
                Конфиденциальность
              </a></li></ul></div></div><div class="tm-footer-menu__block"><h3 class="tm-footer-menu__block-title">
          Услуги
        </h3> <div class="tm-footer-menu__block-content"><ul class="tm-footer-menu__list"><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQLwRfQmXibiUlWaRg-BAc38s7oM3lJiaPju7qmdJsp8ysIvZ_G-Npem0njJLMozE2bPHMpDqiI5hhy/pub?start=false&amp;loop=false&amp;delayms=60000&amp;slide=id.g91a03369cd_4_297" target="_blank">
                Реклама
              </a></li><li class="tm-footer-menu__list-item"><a href="https://habrastorage.org/storage/stuff/habr/service_price.pdf" target="_blank">
                Тарифы
              </a></li><li class="tm-footer-menu__list-item"><a href="https://docs.google.com/presentation/d/e/2PACX-1vQJJds8-Di7BQSP_guHxICN7woVYoN5NP_22ra-BIo4bqnTT9FR6fB-Ku2P0AoRpX0Ds-LRkDeAoD8F/pub?start=false&amp;loop=false&amp;delayms=60000" target="_blank">
                Контент
              </a></li><li class="tm-footer-menu__list-item"><a href="https://tmtm.timepad.ru/" target="_blank">
                Семинары
              </a></li><li class="tm-footer-menu__list-item"><a href="/ru/megaprojects/" class="footer-menu__item-link">
                Мегапроекты
              </a></li></ul></div></div></div></div></div> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><!----> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-vkontakte"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://zen.yandex.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/social-icons-sprite.svg#social-logo-zen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><!---->
        Настройка языка
      </button> <a href="/ru/about" class="tm-footer__link">
        О сайте
      </a> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <!----> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2021 </span> <span class="tm-copyright__name">«<a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a>»</span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"450746":{"id":"450746","timePublished":"2019-05-13T23:09:25+00:00","isCorporative":false,"lang":"ru","titleHtml":"Представляем «CLI Builder»‎-ы","leadData":{"textHtml":"\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fsm\u002Fxo\u002Fkb\u002Fsmxokbjs_uhwjcb1rjv7cwt5k3m.png\" alt=\"Представляем «CLI Builder»‎-ы\"\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nВ этой статье мы рассмотрим новый API Angular CLI, который позволит вам расширять существующие возможности CLI и добавлять новые. Мы обсудим, как работать с этим API, и какие существуют точки его расширения, позволяющие добавлять новый функционал в CLI.\u003Cbr\u003E","imageUrl":null,"buttonTextHtml":"Читать дальше →","image":null},"editorVersion":"1.0","postType":"article","postLabels":[{"type":"translation","data":{"originalAuthorName":"Hans Larsen","originalUrl":"https:\u002F\u002Fblog.angular.io\u002Fd012d4489f1b"}}],"author":{"scoreStats":{"score":2,"votesCount":10},"rating":0,"relatedData":null,"contacts":[{"title":"Сайт","url":"https:\u002F\u002Fscarletflash.dev","value":"https:\u002F\u002Fscarletflash.dev"}],"authorContacts":[{"title":"Сайт","url":"https:\u002F\u002Fscarletflash.dev","value":"https:\u002F\u002Fscarletflash.dev"}],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"id":"1310354","alias":"ScarletFlash","fullname":"Fedor Usakov","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002F3b6\u002Fc91\u002F862\u002F3b6c918620526c49391af54ac03cea3e.png","speciality":"Frontend Tech Lead"},"statistics":{"commentsCount":1,"favoritesCount":32,"readingCount":4286,"score":10,"votesCount":10},"hubs":[{"relatedData":null,"id":"357","alias":"javascript","type":"collective","title":"JavaScript","titleHtml":"JavaScript","isProfiled":true},{"relatedData":null,"id":"18109","alias":"angular","type":"collective","title":"Angular","titleHtml":"Angular","isProfiled":true},{"relatedData":null,"id":"21370","alias":"typescript","type":"collective","title":"TypeScript","titleHtml":"TypeScript","isProfiled":true}],"flows":[{"id":"1","alias":"develop","title":"Разработка"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cimg src=\"\u002Fimg\u002Fimage-loader.svg\" alt=\"Представляем «CLI Builder»‎-ы\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fsm\u002Fxo\u002Fkb\u002Fsmxokbjs_uhwjcb1rjv7cwt5k3m.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ этой статье мы рассмотрим новый API Angular CLI, который позволит вам расширять существующие возможности CLI и добавлять новые. Мы обсудим, как работать с этим API, и какие существуют точки его расширения, позволяющие добавлять новый функционал в CLI.\u003Cbr\u002F\u003E\r\n\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EИстория\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nОколо года назад мы представили файл рабочей области (\u003Ci\u003Eangular.json\u003C\u002Fi\u003E) в Angular CLI и переосмыслили многие базовые принципы реализации его команд. Мы пришли к тому, что разместили команды в «коробках»:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003E\u003Cb\u003ESchematic commands – «Схематические команды»\u003C\u002Fb\u003E. К настоящему времени, вероятно, вы уже слышали о Schematics – библиотеке, используемой CLI для генерации и изменения вашего кода. Она появилась в 5-й версии и, в настоящее время, используется в большинстве команд, которые касаются вашего кода, таких, как \u003Ci\u003Enew\u003C\u002Fi\u003E, \u003Ci\u003Egenerate\u003C\u002Fi\u003E, \u003Ci\u003Eadd\u003C\u002Fi\u003E и \u003Ci\u003Eupdate\u003C\u002Fi\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003EMiscellaneous commands – «Прочие команды»\u003C\u002Fb\u003E. Это команды, которые не относятся непосредственно к вашему проекту: \u003Ci\u003Ehelp\u003C\u002Fi\u003E, \u003Ci\u003Eversion\u003C\u002Fi\u003E, \u003Ci\u003Econfig\u003C\u002Fi\u003E, \u003Ci\u003Edoc\u003C\u002Fi\u003E. Недавно появилась ещё \u003Ci\u003Eanalytics\u003C\u002Fi\u003E, а также наши пасхалки (Тссс! Никому ни слова!).\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003ETask commands – «Команды задач»\u003C\u002Fb\u003E. Эта категория, по большому счету, «запускает процессы, выполняемые над кодом других людей». – Как пример, \u003Ci\u003Ebuild\u003C\u002Fi\u003E – сборка проекта, \u003Ci\u003Elint\u003C\u002Fi\u003E – отладка и \u003Ci\u003Etest\u003C\u002Fi\u003E – тестирование.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nМы начали проектировать \u003Ci\u003Eangular.json\u003C\u002Fi\u003E довольно давно. Изначально, он был задуман как замена Webpack-конфигурации. Кроме того, он должен был позволить разработчикам самостоятельно выбирать реализацию сборки проекта. В итоге, у нас получилась базовая система запуска задач, которая оставалась простой и удобной для наших экспериментов. Мы назвали этот API «Architect».\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНесмотря на то, что Architect официально не поддерживался, он пользовался популярностью среди разработчиков, которые хотели настраивать сборку проектов, а также, среди сторонних библиотек, которым было необходимо контролировать их workflow. Nx использовал его для выполнения команд Bazel, Ionic использовал его для запуска unit-тестов на Jest, а пользователи могли расширять свои конфигурации Webpack-ов с помощью таких инструментов, как \u003Ca href=\"https:\u002F\u002Fwww.npmjs.com\u002Fpackage\u002Fngx-build-plus\"\u003Engx-build-plus\u003C\u002Fa\u003E. И это было только начало.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cb\u003EОфициально поддерживаемая, стабилизированная и улучшенная версия этого API используется в Angular CLI версии 8.\u003C\u002Fb\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EКонцепция\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nArchitect API предлагает инструменты для планирования и координации задач, которые используются в Angular CLI для реализации его команд. Он использует функции, называемые \u003Cbr\u002F\u003E\r\n«builder»-ами – «сборщиками», которые могут выступать в роли задач или же планировщиков других сборщиков. Кроме того, он использует angular.json в качестве набора инструкций для самих сборщиков.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто очень общая система, созданная для того, чтобы быть гибкой и расширяемой. Она содержит API для построения отчетов, ведения логов и тестирования. При необходимости, систему можно расширять для новых задач.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EСборщики\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nСборщики – это функции, реализующие логику и поведение для задачи, которая может заменить команду CLI. – Например, запустить линтер.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nФункция сборщика принимает два аргумента: входное значение (или опции) и контекст, который обеспечивает взаимосвязь между CLI и самим сборщиком. Разделение ответственности здесь такое же, как в Schematics – опции задает пользователь CLI, за контекст отвечает API, а вы (разработчик) устанавливаете необходимое поведение. Поведение может быть реализовано синхронно, асинхронно, либо же просто выводить определенное количество значений. Вывод обязательно должен иметь тип \u003Ci\u003EBuilderOutput\u003C\u002Fi\u003E, содержащий логическое поле \u003Ci\u003Esuccess\u003C\u002Fi\u003E и необязательное поле \u003Ci\u003Eerror\u003C\u002Fi\u003E, содержащее сообщение об ошибке.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EФайл рабочей области и задачи\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nArchitect API полагается на \u003Ci\u003Eangular.json\u003C\u002Fi\u003E – файл рабочей области, для хранения задач и их настроек.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ci\u003Eangular.json\u003C\u002Fi\u003E делит рабочую область на проекты, а их, в свою очередь, на задачи. Например, ваше приложение, созданное с помощью команды \u003Ci\u003Eng new\u003C\u002Fi\u003E, это один из таких проектов. Одной из задач в этом проекте будет задача \u003Ci\u003Ebuild\u003C\u002Fi\u003E, которую можно запустить с помощью команды \u003Ci\u003Eng build\u003C\u002Fi\u003E. По-умолчанию, эта задача имеет три ключа:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003E\u003Cb\u003Ebuilder\u003C\u002Fb\u003E – имя сборщика, который необходимо использовать для выполнения задачи, в формате \u003Ci\u003EНАЗВАНИЕ_ПАКЕТА: НАЗВАНИЕ_СБОРЩИКА\u003C\u002Fi\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003Eoptions\u003C\u002Fb\u003E – настройки, используемые при запуске задачи по-умолчанию.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003Econfigurations\u003C\u002Fb\u003E – настройки, которые применятся при запуске задачи с указанной конфигурацией.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nНастройки применяются следующим образом: когда запускается задача, настройки берутся из блока options, затем, если была указана конфигурация, её настройки записываются поверх существующих. После этого, если в \u003Ci\u003EscheduleTarget()\u003C\u002Fi\u003E были переданы дополнительные настройки – блок \u003Ci\u003Eoverrides\u003C\u002Fi\u003E, они запишутся последними. При использовании Angular CLI, в \u003Ci\u003Eoverrides\u003C\u002Fi\u003E передаются аргументы командной строки. После того, как все настройки переданы сборщику, он проверяет их по своей схеме, и только, если настройки ей соответствуют, будет создан контекст, а сборщик начнет работу.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДополнительная информация о рабочей области \u003Ca href=\"https:\u002F\u002Fangular.io\u002Fguide\u002Fworkspace-config\"\u003Eздесь\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EСоздание собственного сборщика\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nВ качестве примера, давайте создадим сборщик, который будет запускать команду в командной строке. Для создания сборщика, воспользуйтесь фабрикой \u003Ci\u003EcreateBuilder\u003C\u002Fi\u003E и верните объект \u003Ci\u003EBuilderOutput\u003C\u002Fi\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport { BuilderOutput, createBuilder } from '@angular-devkit\u002Farchitect';\n\nexport default createBuilder((options, context) =\u003E {\n  return new Promise&lt;BuilderOutput\u003E(resolve =\u003E {\n    resolve({ success: true });\n  });\n});\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nТеперь, давайте добавим немного логики в наш сборщик: мы хотим, контролировать сборщик через настройки, создавать новые процессы, ждать, пока процесс завершится и, если процесс завершился успешно (то есть, вернул код 0), сигнализировать об этом в Architect:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport { BuilderOutput, createBuilder } from '@angular-devkit\u002Farchitect';\nimport * as childProcess from 'child_process';\n\nexport default createBuilder((options, context) =\u003E {\n  const child = childProcess.spawn(options.command, options.args);\n  return new Promise&lt;BuilderOutput\u003E(resolve =\u003E {\n    child.on('close', code =\u003E {\n      resolve({ success: code === 0 });\n    });\n  });\n});\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EОбработка вывода\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nСейчас, метод \u003Ci\u003Espawn\u003C\u002Fi\u003E передаёт все данные в стандартный вывод процесса. Мы же можем хотеть передавать их в \u003Ci\u003Elogger\u003C\u002Fi\u003E – регистратор. В этом случае, во-первых, будет облегчена отладка при тестировании, а во-вторых, сам Architect может запускать наш сборщик в отдельном процессе или же отключать стандартный вывод процессов (например, в приложении Electron).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДля этого, мы можем использовать \u003Ci\u003ELogger\u003C\u002Fi\u003E, доступный в объекте \u003Ci\u003Econtext\u003C\u002Fi\u003E, который позволит нам перенаправлять вывод процесса:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport { BuilderOutput, createBuilder } from '@angular-devkit\u002Farchitect';\nimport * as childProcess from 'child_process';\n\nexport default createBuilder((options, context) =\u003E {\n  const child = childProcess.spawn(options.command, options.args, { stdio: 'pipe' });\n  child.stdout.on('data', (data) =\u003E {\n    context.logger.info(data.toString());\n  });\n  child.stderr.on('data', (data) =\u003E {\n    context.logger.error(data.toString());\n  });\n\n  return new Promise&lt;BuilderOutput\u003E(resolve =\u003E {\n    child.on('close', code =\u003E {\n      resolve({ success: code === 0 });\n    });\n  });\n});\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EОтчеты о выполнении и статусе\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nЗаключительная часть API, относящаяся к реализации вашего собственного сборщика – отчеты о выполнении и текущем статусе.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ нашем случае, команда либо завершается, либо выполняется, поэтому нет смысла добавлять отчет о выполнении. Однако, мы можем сообщить наш статус родительскому сборщику, чтобы он понимал, что происходит.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport { BuilderOutput, createBuilder } from '@angular-devkit\u002Farchitect';\nimport * as childProcess from 'child_process';\n\nexport default createBuilder((options, context) =\u003E {\n  context.reportStatus(`Executing \"${options.command}\"...`);\n  const child = childProcess.spawn(options.command, options.args, { stdio: 'pipe' });\n\n  child.stdout.on('data', (data) =\u003E {\n    context.logger.info(data.toString());\n  });\n  child.stderr.on('data', (data) =\u003E {\n    context.logger.error(data.toString());\n  });\n\n  return new Promise&lt;BuilderOutput\u003E(resolve =\u003E {\n    context.reportStatus(`Done.`);\n    child.on('close', code =\u003E {\n      resolve({ success: code === 0 });\n    });\n  });\n});\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЧтобы передавать отчет о выполнении, используйте метод \u003Ci\u003EreportProgress\u003C\u002Fi\u003E с текущими и (необязательно) итоговыми значениями, в качестве аргументов. \u003Ci\u003Etotal\u003C\u002Fi\u003E может быть любым числом. Например, если вы знаете, сколько файлов вам нужно обработать, в \u003Ci\u003Etotal\u003C\u002Fi\u003E можно передать их количество, тогда в \u003Ci\u003Ecurrent\u003C\u002Fi\u003E можно передать число уже обработанных файлов. Именно так \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fangular\u002Fangular-cli\u002Fblob\u002F76492141d21649e1924a7a84a2af25ceca294be1\u002Fpackages\u002Fangular_devkit\u002Fbuild_angular\u002Fsrc\u002Ftslint\u002Findex.ts\"\u003Eсборщик tslint\u003C\u002Fa\u003E сообщает о своем прогрессе.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EПроверка входных значений\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nОбъект \u003Ci\u003Eoptions\u003C\u002Fi\u003E, передаваемый в сборщик, проверяется с помощью JSON Schema. Это похоже на Schematics, если вы знаете, что это такое.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВ нашем примере сборщика, мы ожидаем, что наши параметры будут объектом, который получает два ключа: \u003Ci\u003Ecommand\u003C\u002Fi\u003E – команду (строка) и \u003Ci\u003Eargs\u003C\u002Fi\u003E – аргументы (массив строк). Наша схема проверки будет выглядеть так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n  \"$schema\": \"http:\u002F\u002Fjson-schema.org\u002Fschema\",\n  \"type\": \"object\",\n  \"properties\": {\n    \"command\": {\n      \"type\": \"string\"\n    },\n    \"args\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"string\"\n      }\n    }\n  }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nСхемы – действительно мощные инструменты, которые могут проводить большое количество проверок. Для получения дополнительной информации о схемах JSON, вы можете обратиться к \u003Ca href=\"http:\u002F\u002Fjson-schema.org\u002F\"\u003Eофициальному сайту JSON Schema\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EСоздание пакета сборщика\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nСуществует один ключевой файл, который необходимо создать для нашего собственного сборщика, чтобы сделать его совместимым с Angular CLI – \u003Ci\u003Ebuilders.json\u003C\u002Fi\u003E, который отвечает за взаимосвязь нашей реализации сборщика, его имени и схемы проверки. Сам файл выглядит вот так:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n  \"builders\": {\n    \"command\": {\n      \"implementation\": \".\u002Fcommand\",\n      \"schema\": \".\u002Fcommand\u002Fschema.json\",\n      \"description\": \"Runs any command line in the operating system.\"\n    }\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЗатем, в файл \u003Ci\u003Epackage.json\u003C\u002Fi\u003E мы добавляем ключ \u003Ci\u003Ebuilders\u003C\u002Fi\u003E, указывающий на файл \u003Ci\u003Ebuilders.json\u003C\u002Fi\u003E: \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n  \"name\": \"@example\u002Fcommand-runner\",\n  \"version\": \"1.0.0\",\n  \"description\": \"Builder for Architect\",\n  \"builders\": \"builders.json\",\n  \"devDependencies\": {\n    \"@angular-devkit\u002Farchitect\": \"^1.0.0\"\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЭто подскажет Architect, где искать файл определения сборщика.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТаким образом название нашего сборщика – \u003Ci\u003E\"@example\u002Fcommand-runner:command\"\u003C\u002Fi\u003E. Первая часть названия, перед двоеточием (:) – название пакета, определяемое с помощью \u003Ci\u003Epackage.json\u003C\u002Fi\u003E. Вторая часть – название сборщика, определяемое с помощью файла \u003Ci\u003Ebuilders.json\u003C\u002Fi\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EТестирование собственных сборщиков\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nРекомендуемый способ тестирования сборщиков – интеграционное тестирование. Это связано с тем, что создать \u003Ci\u003Econtext\u003C\u002Fi\u003E непросто, поэтому вам стоит воспользоваться планировщиком от Architect.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЧтобы упростить шаблоны, мы продумали простой способ создания экземпляра Architect: сначала вы создаете \u003Ci\u003EJsonSchemaRegistry\u003C\u002Fi\u003E (для проверки схемы), затем, \u003Ci\u003ETestingArchitectHost\u003C\u002Fi\u003E и, в конце концов, экземпляр \u003Ci\u003EArchitect\u003C\u002Fi\u003E. Теперь вы можете составить файл конфигурации \u003Ci\u003Ebuilders.json\u003C\u002Fi\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВот пример запуска сборщика, который выполняет команду \u003Ci\u003Els\u003C\u002Fi\u003E и проверяет, что команда успешно выполнилась. Учтите, что мы будем пользоваться стандартным выводом процессов в \u003Ci\u003Elogger\u003C\u002Fi\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"javascript\"\u003Eimport { Architect, ArchitectHost } from '@angular-devkit\u002Farchitect';\nimport { TestingArchitectHost } from '@angular-devkit\u002Farchitect\u002Ftesting';\nimport { logging, schema } from '@angular-devkit\u002Fcore';\n\ndescribe('Command Runner Builder', () =\u003E {\n  let architect: Architect;\n  let architectHost: ArchitectHost;\n\n  beforeEach(async () =\u003E {\n    const registry = new schema.CoreSchemaRegistry();\n    registry.addPostTransform(schema.transforms.addUndefinedDefaults);\n\n    \u002F\u002F Аргументы TestingArchitectHost – рабочая и текущая директории.\n    \u002F\u002F Сейчас мы их не используем, поэтому они одинаковые.\n    architectHost = new TestingArchitectHost(__dirname, __dirname);\n    architect = new Architect(architectHost, registry);\n\n    \u002F\u002F Тут мы передаем либо имя NPM-пакета,\n    \u002F\u002F либо путь до package.json файла пакета.\n    await architectHost.addBuilderFromPackage('..');\n  });\n\n  \u002F\u002F Это может не работать в Windows\n  it('can run ls', async () =\u003E {\n    \u002F\u002F Создаем регистратор, хранящий массив всех зарегистрированных сообщений.\n    const logger = new logging.Logger('');\n    const logs = [];\n    logger.subscribe(ev =\u003E logs.push(ev.message));\n\n    \u002F\u002F \"run\" может содержать множество выводов, а также информацию о ходе работы сборщика.\n    const run = await architect.scheduleBuilder('@example\u002Fcommand-runner:command', {\n      command: 'ls',\n      args: [__dirname],\n    }, { logger });\n\n    \u002F\u002F \"result\" – следующий вывод выполняемого процесса.\n    \u002F\u002F Он имеет тип \"BuilderOutput\".\n    const output = await run.result;\n    \n    \u002F\u002F Останавливаем сборщик. Architect действительно прекращает сохранение состояний \n    \u002F\u002F сборщика в памяти, так как сборщики ждут, чтобы снова быть запущенными.\n    await run.stop();\n\n    \u002F\u002F Ожидаем успешное завершение.\n    expect(output.success).toBe(true);\n\n    \u002F\u002F Ожидаем, что этот файл будет выведен.\n    \u002F\u002F `ls $__dirname`.\n    expect(logs).toContain('index_spec.ts');\n  });\n});\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЧтобы запустить пример, указанный выше, вам потребуется пакет \u003Ci\u003Ets-node\u003C\u002Fi\u003E. Если вы собираетесь использовать Node, переименуйте \u003Ci\u003Eindex_spec.ts\u003C\u002Fi\u003E в \u003Ci\u003Eindex_spec.js\u003C\u002Fi\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EИспользование сборщика в проекте\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nДавайте создадим простой angular.json, демонстрирующий всё, что мы узнали про сборщики. Если предположить, что мы запаковали наш сборщик в \u003Ci\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fusers\u002Fexample\u002F\" class=\"user_link\"\u003Eexample\u003C\u002Fa\u003E\u002Fcommand-runner\u003C\u002Fi\u003E, а затем создали новое приложение с помощью \u003Ci\u003Eng new builder-test\u003C\u002Fi\u003E, файл \u003Ci\u003Eangular.json\u003C\u002Fi\u003E может выглядеть так (часть содержимого была удалена для краткости):\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003E{\n  \u002F\u002F ... удалено для краткости.\n  \"projects\": {\n    \u002F\u002F ...\n    \"builder-test\": {\n      \u002F\u002F ...\n      \"architect\": {\n        \u002F\u002F ...\n        \"build\": {\n          \"builder\": \"@angular-devkit\u002Fbuild-angular:browser\",\n          \"options\": {\n            \u002F\u002F ... разные опции\n            \"outputPath\": \"dist\u002Fbuilder-test\",\n            \"index\": \"src\u002Findex.html\",\n            \"main\": \"src\u002Fmain.ts\",\n            \"polyfills\": \"src\u002Fpolyfills.ts\",\n            \"tsConfig\": \"src\u002Ftsconfig.app.json\"\n          },\n          \"configurations\": {\n            \"production\": {\n              \u002F\u002F ... разные опции\n              \"optimization\": true,\n              \"aot\": true,\n              \"buildOptimizer\": true\n            }\n          }\n        }\n      }\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЕсли бы мы решили добавить новую задачу для применения (например) команды \u003Ci\u003Etouch\u003C\u002Fi\u003E к файлу (обновляет дату изменения файла), с использованием нашего сборщика, мы бы выполнили \u003Ci\u003Enpm install \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fusers\u002Fexample\u002F\" class=\"user_link\"\u003Eexample\u003C\u002Fa\u003E\u002Fcommand-runner\u003C\u002Fi\u003E, а затем, внесли бы изменения в \u003Ci\u003Eangular.json\u003C\u002Fi\u003E:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"json\"\u003E\n{\n  \"projects\": {\n    \"builder-test\": {\n      \"architect\": {\n        \"touch\": {\n          \"builder\": \"@example\u002Fcommand-runner:command\",\n          \"options\": {\n            \"command\": \"touch\",\n            \"args\": [\n              \"src\u002Fmain.ts\"\n            ]\n          }\n        },\n        \"build\": {\n          \"builder\": \"@angular-devkit\u002Fbuild-angular:browser\",\n          \"options\": {\n            \"outputPath\": \"dist\u002Fbuilder-test\",\n            \"index\": \"src\u002Findex.html\",\n            \"main\": \"src\u002Fmain.ts\",\n            \"polyfills\": \"src\u002Fpolyfills.ts\",\n            \"tsConfig\": \"src\u002Ftsconfig.app.json\"\n          },\n          \"configurations\": {\n            \"production\": {\n              \"fileReplacements\": [\n                {\n                  \"replace\": \"src\u002Fenvironments\u002Fenvironment.ts\",\n                  \"with\": \"src\u002Fenvironments\u002Fenvironment.prod.ts\"\n                }\n              ],\n              \"optimization\": true,\n              \"aot\": true,\n              \"buildOptimizer\": true\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nВ Angular CLI есть команда \u003Ci\u003Erun\u003C\u002Fi\u003E, которая является основной командой для запуска сборщиков. В качестве первого аргумента она принимает строку формата \u003Ci\u003EПРОЕКТ: ЗАДАЧА[: КОНФИГУРАЦИЯ]\u003C\u002Fi\u003E. Чтобы запустить нашу задачу, мы можем воспользоваться командой \u003Ci\u003Eng run builder-test:touch\u003C\u002Fi\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТеперь мы можем хотеть переопределить какие-то аргументы. К сожалению, пока мы не можем переопределять массивы из командной строки, однако мы можем изменить саму команду для демонстрации: \u003Ci\u003Eng run builder-test:touch --command=ls\u003C\u002Fi\u003E. – Это выведет файл \u003Ci\u003Esrc\u002Fmain.ts\u003C\u002Fi\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EWatch Mode – режим наблюдения\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nПредполагается, что по-умолчанию, сборщики будут вызываться единожды и завершаться, однако, они могут возвращать \u003Ci\u003EObservable\u003C\u002Fi\u003E, чтобы реализовывать собственный режим наблюдения (как это делает сборщик \u003Ci\u003EWebpack\u003C\u002Fi\u003E). Architect будет подписан на \u003Ci\u003EObservable\u003C\u002Fi\u003E до тех пор, пока он не завершится или не остановится и сможет подписаться на сборщик снова, если сборщик будет вызван с теми же параметрами (хоть и не гарантированно).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EСборщик должен возвращать объект \u003Ci\u003EBuilderOutput\u003C\u002Fi\u003E после каждого выполнения. После завершения, он может войти в режим наблюдения, вызванный внешним событием и, если он запустится снова, он должен будет вызвать функцию \u003Ci\u003Econtext.reportRunning()\u003C\u002Fi\u003E для уведомления Architect о том, что сборщик снова работает. Это защитит сборщик от остановки его Architect-ом при новом вызове.\u003C\u002Fli\u003E\r\n\u003Cli\u003EArchitect сам отписывается от \u003Ci\u003EObservable\u003C\u002Fi\u003E, когда сборщик останавливается (с помощью run.stop(), например), с использованием \u003Ca href=\"http:\u002F\u002Freactivex.io\u002Frxjs\u002Fclass\u002Fes6\u002FMiscJSDoc.js~TeardownLogicDoc.html\"\u003ETeardown-логики\u003C\u002Fa\u003E – алгоритма уничтожения. Это позволит вам останавливать и очищать сборку, если этот процесс уже запущен.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nРезюмируя вышесказанное, если ваш сборщик наблюдает за внешними событиями, он работает в три этапа:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003E\u003Cb\u003EВыполнение.\u003C\u002Fb\u003E Например, компиляция Webpack. Этот этап заканчивается, когда Webpack заканчивает сборку, а ваш сборщик отправляет \u003Ci\u003EBuilderOutput\u003C\u002Fi\u003E в \u003Ci\u003EObservable\u003C\u002Fi\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003EНаблюдение.\u003C\u002Fb\u003E – Между двумя запусками ведется наблюдение за внешними событиями. Например, Webpack следит за файловой системой на предмет любых изменений. Этот этап заканчивается, когда Webpack возобновляет сборку и вызывается \u003Ci\u003Econtext.reportRunning()\u003C\u002Fi\u003E. После этого этапа снова начинается этап 1.\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003EЗавершение.\u003C\u002Fb\u003E – Задача полностью выполнена (например, ожидалось, что Webpack запустится определенное количество раз) или запуск сборщика был остановлен (с помощью \u003Ci\u003Erun.stop()\u003C\u002Fi\u003E). В этом случае, выполняется алгоритм уничтожения \u003Ci\u003EObservable\u003C\u002Fi\u003E, и он очищается.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003EЗаключение\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nВот, краткое изложение того, что мы узнали в этой публикации:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EМы предоставляем новый API, который позволит разработчикам изменять поведение команд Angular CLI и добавлять новые, используя сборщики, реализующие необходимую логику.\u003C\u002Fli\u003E\r\n\u003Cli\u003EСборщики могут быть синхронными, асинхронными и реагирующими на внешние события. Они могут вызываться несколько раз, а также, вызывать другие сборщики.\u003C\u002Fli\u003E\r\n\u003Cli\u003EПараметры, которые получает сборщик при запуске задачи, сначала считываются из файла \u003Ci\u003Eangular.json\u003C\u002Fi\u003E, затем, перезаписываются параметрами из конфигурации, если она есть, а потом, перезаписываются флагами командной строки, если они были добавлены.\u003C\u002Fli\u003E\r\n\u003Cli\u003EРекомендованный способ тестирования сборщиков – интеграционные тесты, однако вы можете выполнять модульное тестирование отдельно от логики сборщика.\u003C\u002Fli\u003E\r\n\u003Cli\u003EЕсли сборщик возвращает Observable, он должен очищаться после прохождения алгоритма уничтожения.\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nВ ближайшем будущем частота использования этих API будет увеличиваться. Например, реализация Bazel сильно с ними связана.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМы уже видим, как сообщество создает новые CLI сборщики для использования, например, \u003Ci\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fmeltedspark\u002Fangular-builders\u002Ftree\u002Fmaster\u002Fpackages\u002Fjest\"\u003Ejest\u003C\u002Fa\u003E\u003C\u002Fi\u003E и \u003Ci\u003E\u003Ca href=\"https:\u002F\u002Fblog.nrwl.io\u002Fnrwl-nx-7-0-better-e2e-testing-with-cypress-1b88336bef5e\"\u003Ecypress\u003C\u002Fa\u003E\u003C\u002Fi\u003E для тестирования.\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"сборщик"},{"titleHtml":"фронтенд"},{"titleHtml":"фронтенд-разработка"},{"titleHtml":"фронтенд разработка"},{"titleHtml":"фронтенд-фреймворки"},{"titleHtml":"angular"},{"titleHtml":"architect"},{"titleHtml":"architect api"},{"titleHtml":"builder"},{"titleHtml":"cli"},{"titleHtml":"frontend"},{"titleHtml":"frontend development"},{"titleHtml":"google"},{"titleHtml":"javascript"},{"titleHtml":"javascript framework"},{"titleHtml":"rxjs"},{"titleHtml":"typescript"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F450746\u002Fda008bdff0e49f014e1c5bd86a7bd00a\u002F","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabr.com\u002Fshare\u002Fpublication\u002F450746\u002Fda008bdff0e49f014e1c5bd86a7bd00a\u002F?format=vk","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F450746\\\u002F\"},\"headline\":\"Представляем «CLI Builder»‎-ы\",\"datePublished\":\"2019-05-14T02:09:25+03:00\",\"dateModified\":\"2019-05-14T10:28:15+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Fedor Usakov\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"В этой статье мы рассмотрим новый API Angular CLI, который позволит вам расширять существующие возможности CLI и добавлять новые. Мы обсудим, как работать с эт...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fpost\\\u002F450746\\\u002F#post-content-body\",\"about\":[\"h_javascript\",\"h_angular\",\"h_typescript\",\"f_develop\"],\"image\":[\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fsm\\\u002Fxo\\\u002Fkb\\\u002Fsmxokbjs_uhwjcb1rjv7cwt5k3m.png\"]}","metaDescription":"В этой статье мы рассмотрим новый API Angular CLI, который позволит вам расширять существующие возможности CLI и добавлять новые. Мы обсудим, как работать с этим API, и какие существуют точки его...","mainImageUrl":null,"amp":false},"polls":[],"commentsEnabled":true,"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"view":"cards","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"karma":{}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":"javascript,angular,typescript"},"comments":{"articleComments":{},"searchCommentsResults":null,"previewComment":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"vacancies":{}},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0,"isLoadMore":false},"desktopState":{"desktopFl":null,"desktopHl":null,"isChecked":false,"isLoginDemanded":false},"dfp":{"slotsDict":{}},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":"true"},"flows":{"flows":[{"alias":"develop","id":1,"route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":6,"route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":2,"route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":3,"route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":4,"route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":7,"route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"desktop","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"infoPage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""},"searchQuery":null},"me":{"user":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"pinnedPost":{"pinnedPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"items":{},"pagesCache":{},"markedViewedSilently":{},"markedRead":{},"unreadCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null},"unviewedCounters":{"applications":null,"system":null,"mentions":null,"subscribers":null,"posts_and_comments":null}}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.c2c3fc9a.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.c0af73e7.js" defer></script>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
</body>
</html>
